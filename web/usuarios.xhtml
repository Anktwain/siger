<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Usuarios</title>
    <h:outputStylesheet library="css" name="usuarios.css" />
    <link rel="shortcut icon" href="resources/img/iconos/icono1.ico" type="image/x-icon" />
  </h:head>
  <f:metadata>
    <f:event listener="#{indexBean.verificarAcceso('usuarios')}" type="preRenderView" />
  </f:metadata>
  <h:body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <div id="overlay" class="transparent" style="display: none"></div>        
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home"></i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">Usuarios</li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Usuarios</h3>
          <span>Agregue o elimine usuarios del sistema, confirme o elimine a los 
            gestores y modifique informaci&oacute;n de todos los usuarios del 
            sistema.</span>
        </div>
      </div>
      <div class="padding-md">
        <div class="row">
          <h:form id="botonesUsuariosForm">
            <div class="col-xs-3">
              <div class="panel-stat3 bg-danger">
                <h3 class="m-top-none">Confirmar gestores</h3>
                <div id="botonazo">
                  <p:commandButton value="Confirmar" class="btn btn-default" oncomplete="PF('dlgConfirmarGestores').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-check-circle-o fa-2x" />
                </div>
              </div>
            </div>
            <div class="col-xs-3">
              <div class="panel-stat3 bg-info">
                <h3 class="m-top-none">Nuevo usuario</h3>
                <div id="botonazo">
                  <p:commandButton value="Nuevo usuario" class="btn btn-default" oncomplete="PF('dlgNuevoUsuario').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-plus fa-2x" />
                </div>
              </div>
            </div>
            <div class="col-xs-3">
              <div class="panel-stat3 bg-primary">
                <h3 class="m-top-none">Buscar usuarios</h3>
                <div id="botonazo">
                  <p:commandButton value="Buscar" class="btn btn-default" oncomplete="PF('dlgBuscarUsuarios').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-search fa-2x" />
                </div>
              </div>
            </div>
          </h:form>
        </div>
      </div>
    </div><!-- /main-container -->
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </h:body>
  <!-- DIALOGO PARA CONFIRMAR GESTORES -->
  <p:dialog widgetVar="dlgConfirmarGestores" header="Confirmar gestores" modal="true" resizable="false">
    <h:form id="formConfirmarGestores">
      <br />
      <p:contextMenu for="gestoresPorConfirmar" style="width:200px;">
        <p:menuitem value="Confirmar" icon="ui-icon-check" actionListener="#{usuariosBean.confirmarGestor()}" update=":growl, gestoresPorConfirmar, formBuscarUsuarios" />
        <p:menuitem value="Rechazar" icon="ui-icon-close" actionListener="#{usuariosBean.rechazarGestor()}" update=":growl, gestoresPorConfirmar" />
      </p:contextMenu>
      <p:dataTable id="gestoresPorConfirmar" var="u" value="#{usuariosBean.usuariosNoConfirmados}" rowKey="#{u.idUsuario}" selectionMode="single" selection="#{usuariosBean.usuarioSeleccionado}" emptyMessage="No existen gestores por confirmar."  paginator="true" rows="15" paginatorPosition="bottom" paginatorAlwaysVisible="false" style="width: 700px;">
        <f:facet name="header">
          Lista de usuarios por confirmar para este despacho
        </f:facet>
        <p:column headerText="Nombre" style="width:250px;" > 
          <h:outputText value="#{u.nombre} #{u.paterno} #{u.materno}"/>
        </p:column>
        <p:column headerText="Nombre de login" style="width:150px;" > 
          <h:outputText value="#{u.nombreLogin}"/>
        </p:column>
        <p:column headerText="Correo proporcionado" style="width:250px;" > 
          <h:outputText value="#{u.correo}"/>
        </p:column>
      </p:dataTable>
      <br />
      <div align="center">
        <p:commandButton value="Ok" icon="ui-icon-check" oncomplete="PF('dlgConfirmarGestores').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA NUEVO USUARIO -->
  <p:dialog widgetVar="dlgNuevoUsuario" header="Agregar un usuario" modal="true" resizable="false">
    <h:form id="nuevousuarioForm">
      <br />
      Por favor complete el siguiente formulario:
      <br />
      <br />
      Nombre(s):
      <br />
      <p:inputText value="#{usuariosBean.nombreNuevoUsuario}" size="35" maxlength="50" required="true" requiredMessage="Debe escribir su(s) nombre(s)" />
      <br />
      Apellido Paterno:
      <br />
      <p:inputText value="#{usuariosBean.paternoNuevoUsuario}" size="20" maxlength="30" required="true" requiredMessage="Debe escribir su apellido paterno" />
      <br />
      Apellido Materno:
      <br />
      <p:inputText value="#{usuariosBean.maternoNuevoUsuario}" size="20" maxlength="30" />
      <br />
      Nombre de usuario:
      <br />
      <p:inputText value="#{usuariosBean.loginNuevoUsuario}" size="15" maxlength="15" required="true" requiredMessage="Debe escribir un nombre de usuario" />
      <br />
      Contraseña:
      <br />
      <p:inputText value="#{usuariosBean.passwordNuevoUsuario}" size="20" maxlength="20" required="true" type="password" requiredMessage="Debe escribir una contraseña" />
      <br />
      Confirme la contraseña:
      <br />
      <p:inputText value="#{usuariosBean.password2NuevoUsuario}" size="20" maxlength="20" required="true" type="password" requiredMessage="Debe confirmar la contraseña" />
      <br />
      Dirección de correo electrónico:
      <br />
      <p:inputText value="#{usuariosBean.correoNuevoUsuario}" size="30" maxlength="50" required="true" requiredMessage="Debe escribir una direccion de correo electronico" />
      <br />
      Perfil del nuevo usuario:
      <br />
      <p:selectOneMenu value="#{usuariosBean.tipoUsuarioSeleccionado}">
        <f:selectItems value="#{usuariosBean.tipoUsuarios}" var="t" itemLabel="#{t}" itemValue="#{t}" />
      </p:selectOneMenu>
      <br />
      <br />
      <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{usuariosBean.crearUsuario()}" update=":growl, formBuscarUsuarios" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dlgNuevoUsuario').hide();" />
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA BUSCAR USUARIOS -->
  <p:dialog widgetVar="dlgBuscarUsuarios" header="Busqueda de usuarios" modal="true" resizable="false">
    <h:form id="formBuscarUsuarios">
      <br />
      <p:contextMenu for="usuariosActuales" style="width:200px;">
        <p:menuitem value="Ver detalle" icon="ui-icon-search" oncomplete="PF('dlgDetalleUsuario').show();" update="detalleUsuarioForm" />
        <p:menuitem value="Eliminar" icon="ui-icon-close" oncomplete="PF('dlgEliminarUsuario').show();" />
      </p:contextMenu>
      <p:dataTable id="usuariosActuales" var="u" value="#{usuariosBean.usuariosActuales}" rowKey="#{u.idUsuario}" selectionMode="single" selection="#{usuariosBean.usuarioSeleccionado}" emptyMessage="No existen gestores por confirmar."  paginator="true" rows="15" paginatorPosition="bottom" paginatorAlwaysVisible="false" style="width: 800px;">
        <f:facet name="header">
          Lista de usuarios en este despacho
        </f:facet>
        <p:column headerText="Nombre" style="width:250px;" > 
          <h:outputText value="#{u.nombre} #{u.paterno} #{u.materno}"/>
        </p:column>
        <p:column headerText="Correo proporcionado" style="width:300px;" > 
          <h:outputText value="#{u.correo}"/>
        </p:column>
        <p:column headerText="Perfil" style="width:200px;" > 
          <h:outputText value="#{usuariosBean.etiquetarPerfiles(u.perfil)}"/>
        </p:column>
      </p:dataTable>
      <br />
      <div align="center">
        <p:commandButton value="Ok" icon="ui-icon-check" oncomplete="PF('dlgBuscarUsuarios').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO DETALLE USUARIO -->
  <p:dialog widgetVar="dlgDetalleUsuario" header="Detalle del gestor" modal="true" resizable="false" showEffect="fade" hideEffect="fade">
    <h:form id="detalleUsuarioForm">
      <p:outputPanel style="text-align:center;">
        <p:panelGrid columns="2">
          <f:facet name="header">
            <p:graphicImage library="img" name="#{usuariosBean.usuarioSeleccionado.imagenPerfil}" width="200" height="200" />
          </f:facet>
          <h:outputText value="Nombre: "/>
          <p:inputText value="#{usuariosBean.usuarioSeleccionado.nombre}"  />
          <h:outputText value="Apellido paterno: "/>
          <p:inputText value="#{usuariosBean.usuarioSeleccionado.paterno}" />
          <h:outputText value="Apellido materno: "/>
          <p:inputText value="#{usuariosBean.usuarioSeleccionado.materno}" />
          <h:outputText value="Nombre login: "/>
          <p:inputText value="#{usuariosBean.usuarioSeleccionado.nombreLogin}" />
          <h:outputText value="Perfil: "/>
          <h:outputText value="#{usuariosBean.etiquetarPerfiles(usuariosBean.usuarioSeleccionado.perfil)}" />
          <h:outputText value="Correo: "/>
          <h:inputText value="#{usuariosBean.usuarioSeleccionado.correo}" />
          <f:facet name="footer">
            <br />
            <div align="center">
              <p:commandButton value="Ok" icon="ui-icon-check" actionListener="#{usuariosBean.modificarUsuario()}" update=":growl, formBuscarUsuarios" />
            </div>
            <br />
          </f:facet>
        </p:panelGrid>
      </p:outputPanel>
    </h:form>
  </p:dialog>
  <!-- DIALOGO ELIMINAR USUARIO -->
  <p:dialog widgetVar="dlgEliminarUsuario" header="Confirme esta accion" modal="true" resizable="false">
    <h:form id="formEliminarUsuario">
      Esta seguro de elimiar a este usuario?
      <br />
      <br />
      Esta accion provocara que:
      <ul style="list-style-type:disc; padding: 20px;">
        <li>Todos su creditos se reasignen entre los gestores activos.</li>
        <li>Se finalizen todos los convenios de pago.</li>
        <li>Se eliminen las zonas asignadas para este gestor.</li>
        <li>NOTA: Los cambios no tomaran efecto hasta que el usuario cierre sesion.</li>
      </ul>
      <p:commandButton value="Eliminar usuario" icon="ui-icon-check" actionListener="#{usuariosBean.eliminarUsuario()}" update=":growl, formBuscarUsuarios" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dlgEliminarUsuario').hide();" />
    </h:form>
  </p:dialog>
  <!-- DIALOGO BARRA DE CARGA -->
  <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
  <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false" >
    <p:graphicImage library="img" name="loadingBarra.gif" />
  </p:dialog>
</html>