<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Usuarios</title>
    <h:outputStylesheet library="css" name="usuarios.css" />
    <link rel="shortcut icon" href="resources/img/iconos/icono1.ico" type="image/x-icon" />
  </h:head>
  <h:body>
    <!--<p:growl id="growl" showDetail="true" sticky="true" />-->
    <div id="overlay" class="transparent" style="display: none"></div>        
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container"> 

      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home"></i>
            <a href="panelAdministrativo.xhtml">Inicio</a>
          </li>
          <li class="active">Usuarios</li>
        </ul>
      </div>

      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Usuarios</h3>
          <span>Agregue o elimine usuarios del sistema, confirme o elimine a los 
            gestores y modifique informaci&oacute;n de todos los usuarios del 
            sistema.</span>
        </div>
      </div>

      <ui:include src="barraAdministrativo.xhtml" />

      <div id="opciones">

        <div class="row">
          <div class="padding-md">
            <div class="col-xs-4">
              <div class="panel-stat3 bg-danger">
                <h3 class="m-top-none">Confirmar gestores</h3>
<!--                <p:commandButton value="Confirmar" class="btn btn-primary" actionListener="#{vistaClientes.direccionBean.listarEstados()}" onclick="PF('dlgAltaCliente').show();"/>-->
                <div id="botonazo">
                  <p:commandButton value="Confirmar" class="btn btn-default" onclick="PF('dlgNuevaEmpresa').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-check-circle-o fa-3x"/>
                </div>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="panel-stat3 bg-info">
                <h3 class="m-top-none">Dar de alta usuario</h3>
                <!--<p:commandButton value="Nuevo" class="btn btn-primary" actionListener="#{vistaClientes.direccionBean.listarEstados()}" onclick="PF('dlgAltaCliente').show();"/>-->
                <div id="botonazo">
                  <p:commandButton value="Nuevo" class="btn btn-default" onclick="PF('dlgNuevaEmpresa').show();" />
                </div>

                <div class="stat-icon">
                  <i class="fa fa-pencil fa-3x"/>
                </div>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="panel-stat3 bg-primary">
                <h3 class="m-top-none">Buscar usuario</h3>
                <!--<p:commandButton value="Buscar" class="btn btn-primary" actionListener="#{vistaClientes.direccionBean.listarEstados()}" onclick="PF('dlgAltaCliente').show();"/>-->
                <div id="botonazo">
                  <p:commandButton value="Buscar" class="btn btn-default" onclick="PF('dlgNuevaEmpresa').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-search fa-3x"/>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- row -->


        <div class="panel panel-default">
          <!--<div class="panel-heading h1 text-center"></div>-->
          <div class="panel-tab clearfix">
            <ul class="tab-bar h4">
              <li class="active"><a href="#tabConfirmar" data-toggle="tab">
                  <i class="fa fa-check-circle-o"></i> Gestores no confirmados</a>
              </li>     
              <li><a href="#tabRegistrar" data-toggle="tab">
                  <i class="fa fa-pencil"></i> Nuevos usuarios</a>
              </li>
              <li><a href="#tabBuscar" data-toggle="tab">
                  <i class="fa fa-search"></i> Usuarios del sistema</a>
              </li>
            </ul>
          </div>
          <!--<div class="panel-body">-->
          <div class="tab-content">            

            <div class="tab-pane fade in active" id="tabConfirmar">
              <h:form>
                <div id="confirmagestores" class="panel bg-danger">
                  <div class="panel-body">
                    <h4>Confirme o elimine a los usuarios en espera de ingresar al sistema.</h4>

                    <h:form id="formConfirmarGestores">
                      <h:form id="tabla">
                        <p:dataTable id="noConfirmados" var="usuarios" value="#{usuariosBean.gestoresNoConfirmados}" paginator="true" paginatorAlwaysVisible="false" 
                                     paginatorPosition="bottom" selection="#{usuariosBean.gestoresPorConfirmar}" rowKey="#{usuarios.nombreLogin}"  rows="10"
                                     emptyMessage="Todos los usuarios est&aacute;n confirmados.">
                          <f:facet name="header"> Usuarios no confirmados </f:facet>
                          <p:column selectionMode="multiple" style="width:30px;text-align:right" />
                          <p:column headerText="Nombre del usuario" style="width:110px;">
                            <h:outputText value="#{usuarios.nombre}" />
                          </p:column>
                          <p:column headerText="Apellido Paterno" style="width:100px;">
                            <h:outputText value="#{usuarios.paterno}" />
                          </p:column>
                          <p:column headerText="Apellido Materno" style="width:100px;">
                            <h:outputText value="#{usuarios.materno}" />
                          </p:column>
                          <p:column headerText="Correo" style="width:200px;">
                            <h:outputText value="#{usuarios.correo}" />
                          </p:column>
                          <f:facet name="footer">
                            <p:commandButton process="noConfirmados" icon="ui-icon-check" value="Confirmar" actionListener="#{usuariosBean.confirmarGestores(usuariosBean.gestoresPorConfirmar)}" />
                            <p:commandButton process="noConfirmados" icon="ui-icon-trash" value="Eliminar" actionListener="#{usuariosBean.eliminarGestores(usuariosBean.gestoresPorConfirmar)}" />
                          </f:facet>
                        </p:dataTable>
                      </h:form>
                    </h:form>
                  </div> <!-- /.panel-body -->
                </div> <!-- /#confirmagestores -->
              </h:form>
            </div>

            <div class="tab-pane fade" id="tabRegistrar">
              <h:form>
                <div id="nuevousuario" class="panel bg-info">
                  <div class="panel-body">
                    <h4>Agregue un gestor o administrativo al sistema.</h4>
                    <h:form id="formNuevoUsuario">
                      <div class="">
                        <div class="">
                          <div class="form-group">
                            <p:outputLabel value="Nombre(s): " />
                            <p:inputText id="nombre" type="text" class="form-control input-sm" value="#{usuariosBean.nombre}"
                                         required="true" requiredMessage="Ingrese un nombre"/>
                          </div><!-- /form-group -->
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <p:outputLabel value="Apellido Paterno:" />
                                <p:inputText id="paterno" type="text" class="form-control input-sm" value="#{usuariosBean.paterno}" />
                              </div>
                            </div><!-- /.col -->
                            <div class="col-md-6">
                              <div class="form-group">
                                <p:outputLabel id="materno" value="Apellido Materno:" />
                                <p:inputText type="text" class="form-control input-sm" value="#{usuariosBean.materno}" />
                              </div>
                            </div><!-- /.col -->
                          </div><!-- /.row -->
                          <div class="form-group">
                            <p:outputLabel id="nombreUsuario" value="Nombre de Usuario: " />
                            <p:inputText type="text" class="form-control input-sm" value="#{usuariosBean.nombreLogin}"
                                         required="true" requiredMessage="Ingrese un nombre de usuario" />
                          </div><!-- /form-group -->
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <p:outputLabel value="Contraseña:" />
                                <p:password id="password" class="form-control input-sm" value="#{usuariosBean.password}"
                                            required="true" requiredMessage="Ingrese una contraseña"/>
                              </div>
                            </div><!-- /.col -->
                            <div class="col-md-6">
                              <div class="form-group">
                                <p:outputLabel id="confirmePassword" value="Confirme su Contraseña:" />
                                <p:password class="form-control input-sm" value="#{usuariosBean.confirmePassword}" />
                              </div>
                            </div><!-- /.col -->
                          </div><!-- /.row -->
                          <div class="form-group">
                            <p:outputLabel value="E-mail: " />
                            <p:inputText type="text" class="form-control input-sm" value="#{usuariosBean.correo}"
                                         required="true" requiredMessage="Ingrese una dirección de correo electrónico"/>
                          </div><!-- /form-group -->
                          <div class="form-group">
                            <p:outputLabel value="Perfil: " />
                            <h:selectOneMenu id="perfil" value="#{usuariosBean.perfil}" class="form-control chzn-select"
                                             required="true" requiredMessage="Especifique perfil">
                              <f:selectItem itemLabel="Seleccione perfil"/>
                              <f:selectItem itemLabel="Administrador" itemValue="1" />
                              <f:selectItem itemLabel="Gestor" itemValue="2" />
                            </h:selectOneMenu>
                          </div><!-- /form-group -->
                        </div>
                        <div class="">
                          <p:commandButton styleClass="btn btn-danger tooltip-test" actionListener="#{usuariosBean.insertar}" value="Aceptar"/>
                          <p:commandButton styleClass="btn btn-success btn-sm tooltip-test" type="reset" value="Agregar Otro" />
                        </div> <!-- .modal-footer -->
                      </div> <!-- /.modal-content -->
                    </h:form> <!-- #formNuevoUsuario  -->
                  </div> <!-- .panel-body  -->
                </div> <!-- #nuevousuario  -->
              </h:form>
            </div> <!-- #tabRegistrar -->

            <div class="tab-pane fade" id="tabBuscar">
              <div id="buscausuarios" class="panel bg-primary">
                <div class="panel-body form-group">
                  <h4>Consulte y modifique a los usuarios del sistema.</h4>

                </div>
              </div> <!-- #buscausuarios -->

            </div> <!-- #tabBuscar -->
          </div> <!-- .tabContent -->
          <!--</div>  .panelbody -->
        </div><!-- /panel -->
      </div> <!-- #opciones -->


      <h:form id="formUsuarios">
        <p:contextMenu for="usuarios">
          <p:menuitem value="Ver detalle" update="usuarioDetail, usSelecNombre" icon="ui-icon-search" oncomplete="PF('usuarioDialog').show()"/>
        </p:contextMenu>

        <p:dataTable id="usuarios" var="usuario" value="#{usuariosBean.todosUsuarios}" rowKey="#{usuario.nombreLogin}" 
                     selection="#{usuariosBean.usuarioSeleccionado}" selectionMode="single" widgetVar="usuarioDataTable" 
                     paginator="true" rows="10" paginatorAlwaysVisible="false" paginatorPosition="bottom" 
                     emptyMessage="Ning&uacute;n usuario coincide con el criterio de b&uacute;squeda." 
                     filteredValue="#{usuariosBean.usuariosEncontrados}"  >

          <f:facet name="header_tabBuscar">
            <p:outputPanel>
              <h:outputText value="Buscar en todos los usuarios:  " />
              <p:inputText id="globalFilter" onkeyup="PF('usuarioDataTable').filter()" style="width:150px" placeholder="Palabra clave"/>
            </p:outputPanel>
          </f:facet>

          <p:column headerText="Nombre" filterBy="#{usuario.nombre}" filterMatchMode="contains"> 
            <h:outputText value="#{usuario.nombre}"/>
          </p:column>
          <p:column headerText="Apellido paterno" filterBy="#{usuario.paterno}" filterMatchMode="contains">
            <h:outputText value="#{usuario.paterno}"/>
          </p:column>
          <p:column headerText="Apellido materno" filterBy="#{usuario.materno}" filterMatchMode="contains">
            <h:outputText value="#{usuario.materno}"/>                         
          </p:column>

          <p:column headerText="Nombre login" filterBy="#{usuario.nombreLogin}" filterMatchMode="contains">
            <h:outputText value="#{usuario.nombreLogin}"/>                           
          </p:column>
        </p:dataTable>

        <p:dialog closeOnEscape="true" header="Informaci&oacute;n detallada del usuario" widgetVar="usuarioDialog" 
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
          <p:outputPanel id="usuarioDetail" style="text-align:center;">

            <p:panelGrid columns="2" rendered="#{not empty usuariosBean.usuarioSeleccionado}">

              <f:facet name="header">
                <p:graphicImage library="img" name="#{usuariosBean.usuarioSeleccionado.imagenPerfil}" height="200px"/> 
              </f:facet>

              <h:outputText value="Nombre: "/>
              <p:inputText disabled="true" id="usSelecNombre" value="#{usuariosBean.usuarioSeleccionado.nombre}"  /> 

              <h:outputText value="Apellido paterno: "/>
              <p:inputText disabled="true" value="#{usuariosBean.usuarioSeleccionado.paterno}" />

              <h:outputText value="Apellido materno: "/>
              <p:inputText disabled="true" value="#{usuariosBean.usuarioSeleccionado.materno}" />

              <h:outputText value="Nombre login: "/>
              <p:inputText disabled="true" value="#{usuariosBean.usuarioSeleccionado.nombreLogin}" />

              <h:outputText value="Perfil: "/>
              <p:selectOneMenu disabled="true" onchange="" >
                <f:selectItems  value="#{usuariosBean.perfilBean.ordenarLista(usuariosBean.usuarioSeleccionado.perfil)}" />
              </p:selectOneMenu>p

              <h:outputText value="Correo: "/>
              <h:inputText disabled="true" value="#{usuariosBean.usuarioSeleccionado.correo}" />

              <f:facet name="footer">
                <div class="text-center">
                  <p:commandButton value="Modificar" id="ajax" update="usuarioDetail" />
                  <p:commandButton value="Eliminar" id="nonAjax" ajax="false" />
                </div>                              
              </f:facet>
            </p:panelGrid>
          </p:outputPanel>
        </p:dialog>
      </h:form>

    </div><!-- /main-container -->
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </h:body>
</html>