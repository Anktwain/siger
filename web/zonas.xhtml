<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Zonas</title>
    <script src="http://maps.googleapis.com/maps/api/js" />
    <script>
      var google;
      function initialize() {
        var mapProp = {
          center: new google.maps.LatLng(19.432545, -99.133271), zoom: 10, mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        var coords = [{lat: 19.680495, lng: -98.972024}, {lat: 19.419421, lng: -99.089992}, {lat: 19.358815, lng: -99.146142}, {lat: 19.505036, lng: -99.145970}, {lat: 19.680495, lng: -98.972024}];
        var chavezCoords = new google.maps.Polygon({
          paths: coords,
          strokeColor: '#0000FF',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#0000FF',
          fillOpacity: 0.35
        });
        chavezCoords.setMap(map);
        coords = [{lat: 19.358815, lng: -99.146142}, {lat: 19.505036, lng: -99.145970}, {lat: 19.439106, lng: -99.273667}, {lat: 19.358815, lng: -99.146142}];
        var tonyCoords = new google.maps.Polygon({
          paths: coords,
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35
        });
        tonyCoords.setMap(map);
        coords = [{lat: 19.795728, lng: -99.089333}, {lat: 19.686450, lng: -99.050424}, {lat: 19.503135, lng: -99.133484}, {lat: 19.795728, lng: -99.089333}];
        var seaCoords = new google.maps.Polygon({
          paths: coords,
          strokeColor: '#00994C',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#00994C',
          fillOpacity: 0.35
        });
        seaCoords.setMap(map);
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </h:head> 
  <body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <!-- Overlay Div -->
    <div id="overlay" class="transparent" style="display: none"></div>
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Zonas
          </li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Zonas</h3>
          <span>Crear, visualizar y editar las zonas de cobranza.</span>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6" id="googleMap" style="width:450px;height:380px; margin-left: 50px; margin-right: 70px;" />
        <div class="col-sm-3">
          <div class="row">
            <div class="col-lg padding-lg">
              <h:form>
                <div class="panel-stat3 bg-success">
                  <h3 class="m-top-none">Nueva zona</h3>
                  <div id="botonazo">
                    <p:commandButton value="Crear" oncomplete="PF('dlgNuevaZona').show();" />
                  </div>
                  <div class="stat-icon">
                    <i class="fa fa-map-marker fa-2x" />
                  </div>
                </div>
                <br />
                <br />
                <div class="panel-stat3 bg-info">
                  <h3 class="m-top-none">Visualizar zonas</h3>
                  <div id="botonazo">
                    <p:commandButton value="Visualizar" actionListener="#{zonasBean.cargarZonas()}" />
                  </div>
                  <div class="stat-icon">
                    <i class="fa fa-globe fa-2x" />
                  </div>
                </div>
              </h:form>
            </div>                                          
          </div>
        </div>
      </div>
    </div><!-- /main-container -->
    <!-- DIALOGO PARA CREAR LAS ZONAS -->
    <p:dialog id="nuevaZonaDialog" widgetVar="dlgNuevaZona" header="Agregar una zona" modal="true" resizable="false">
      <h:form id="nuevaZonaForm">
        <p:layout id="nuevaZonaLayout" style="width: 600px; height: 350px;">
          <p:layoutUnit position="west" size="300">
            Estados:
            <br />
            <br />
            <p:selectManyMenu value="#{zonasBean.estadosSeleccionados}" filter="true" filterMatchMode="contains" showCheckbox="true" disabled="#{zonasBean.habilitaEstados}" style="width: 280px; height: 250px;">
              <f:selectItems value="#{zonasBean.listaEstados}" var="e" itemLabel="#{e.nombre}" itemValue="#{e.idEstado}" />
            </p:selectManyMenu>
            <br />
            <p:commandButton value="Agregar estados" actionListener="#{zonasBean.verificaEstados()}" disabled="#{zonasBean.habilitaEstados}" update=":growl" />
          </p:layoutUnit>
          <p:layoutUnit position="center" size="300">
            Municipios:
            <br />
            <br />
            <p:selectManyMenu value="#{zonasBean.municipiosSeleccionados}" filter="true" filterMatchMode="contains" showCheckbox="true" disabled="#{zonasBean.habilitaMunicipios}" style="width: 280px; height: 250px;">
              <f:selectItems value="#{zonasBean.listaMunicipios}" var="mun" itemLabel="#{mun.nombre}" itemValue="#{mun.idMunicipio}" />
            </p:selectManyMenu>
            <br />
            <p:commandButton value="Agregar municipios" actionListener="#{zonasBean.verificaMunicipios()}" disabled="#{zonasBean.habilitaMunicipios}" update=":growl" />
            &nbsp;&nbsp;&nbsp;
            <p:commandButton value="Agregar todos" actionListener="#{zonasBean.agregarTodosMunicipios()}" update=":growl" disabled="true" />
          </p:layoutUnit>
        </p:layout>
        <br />
        <br />
        Nombre para la zona:
        &nbsp;&nbsp;
        <p:inputText value="#{zonasBean.nombreZona}" size="20" />
        <br />
        <br />
        Gestor asignado para esta zona:
        &nbsp;&nbsp;
        <p:selectOneMenu value="#{zonasBean.gestorSeleccionado.idGestor}" style="width:200px">
          <f:selectItems value="#{zonasBean.listaGestores}" var="g" itemValue="#{g.idGestor}" itemLabel="#{g.toString()}" />
        </p:selectOneMenu>
        <br />
        <br />
        <p:commandButton value="Crear zona" actionListener="#{zonasBean.crearZona()}" update=":growl" />
        &nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" actionListener="#{zonasBean.cancelar()}" />
      </h:form>
    </p:dialog>
    <p:dialog widgetVar="dlgZonas" header="Zonas disponibles actualmente" modal="true" resizable="false">
      <h:form id="listaZonasForm" >
        <p:contextMenu for="zonas" style="width:200px;">
          <p:menuitem value="Eliminar zona" icon="ui-icon-close" />
          <p:menuitem value="Reasignar gestor" icon="ui-icon-alert" />
        </p:contextMenu>
        <p:dataTable id="zonas" var="z" value="#{zonasBean.listaZonas}" emptyMessage="No existen zonas designadas en este despacho." rowKey="#{z.idZona}" selection="#{zonasBean.zonaSeleccionada}" selectionMode="single" paginator="true" rows="15" paginatorPosition="bottom" paginatorAlwaysVisible="false" style="width: 800px;">
          <p:column headerText="Nombre de la zona" style="width:250px;">
            <h:outputText value="#{z.nombre}" />
          </p:column>
          <p:column headerText="Estados en esta zona" style="width:250px;">
            <h:outputText value="#{z.estadosZona}" />
          </p:column>
          <p:column headerText="Municipios en esta zona" style="width:250px;">
            <h:outputText value="#{z.municipiosZona}" />
          </p:column>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </body>
</html>
