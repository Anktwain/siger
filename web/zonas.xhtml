<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Zonas</title>
    <script src="http://maps.googleapis.com/maps/api/js" />
    <script>
      var google;
      function initialize() {
        var mapProp = {
          center: new google.maps.LatLng(19.432545, -99.133271), zoom: 10, mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        var coords = [{lat: 19.680495, lng: -98.972024}, {lat: 19.419421, lng: -99.089992}, {lat: 19.358815, lng: -99.146142}, {lat: 19.505036, lng: -99.145970}, {lat: 19.680495, lng: -98.972024}];
        var chavezCoords = new google.maps.Polygon({
          paths: coords,
          strokeColor: '#0000FF',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#0000FF',
          fillOpacity: 0.35
        });
        chavezCoords.setMap(map);
        coords = [{lat: 19.358815, lng: -99.146142}, {lat: 19.505036, lng: -99.145970}, {lat: 19.439106, lng: -99.273667}, {lat: 19.358815, lng: -99.146142}];
        var tonyCoords = new google.maps.Polygon({
          paths: coords,
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35
        });
        tonyCoords.setMap(map);
        coords = [{lat: 19.795728, lng: -99.089333}, {lat: 19.686450, lng: -99.050424}, {lat: 19.503135, lng: -99.133484}, {lat: 19.795728, lng: -99.089333}];
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </h:head> 
  <body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <!-- Overlay Div -->
    <div id="overlay" class="transparent" style="display: none"></div>
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Zonas
          </li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Zonas</h3>
          <span>Crear, visualizar y editar las zonas de cobranza.</span>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6" id="googleMap" style="width:450px;height:380px; margin-left: 50px; margin-right: 70px;" />
        <div class="col-sm-3">
          <div class="row">
            <div class="col-lg padding-lg">
              <h:form>
                <div class="panel-stat3 bg-success">
                  <h3 class="m-top-none">Nueva zona</h3>
                  <div id="botonazo">
                    <p:commandButton value="Crear" oncomplete="PF('dlgNuevaZona').show();" />
                  </div>
                  <div class="stat-icon">
                    <i class="fa fa-map-marker fa-2x" />
                  </div>
                </div>
                <br />
                <br />
                <div class="panel-stat3 bg-info">
                  <h3 class="m-top-none">Visualizar zonas</h3>
                  <div id="botonazo">
                    <p:commandButton value="Visualizar" oncomplete="PF('dlgZonas').show();" />
                  </div>
                  <div class="stat-icon">
                    <i class="fa fa-globe fa-2x" />
                  </div>
                </div>
              </h:form>
            </div>                                          
          </div>
        </div>
      </div>
    </div><!-- /main-container -->
    <!-- DIALOGO PARA CREAR LAS ZONAS -->
    <p:dialog id="nuevaZonaDialog" widgetVar="dlgNuevaZona" header="Agregar una zona" modal="true" resizable="false" style="width: 600px;">
      <h:form id="nuevaZonaForm">
        <p:dataTable var="m" value="#{zonasBean.listaMunicipios}" selection="#{zonasBean.municipiosSeleccionados}" rowKey="#{m.idMunicipio}" emptyMessage="No existen municipios disponibles." scrollable="true" scrollHeight="220" style="width: 550px;">
          <p:column selectionMode="multiple" style="width: 35px;"/>
          <p:column headerText="Estado" filterBy="#{m.estadoRepublica.nombre}" filterMatchMode="startsWith" style="width: 250px;" filterStyle="width: 150px;" >
            <h:outputText value="#{m.estadoRepublica.nombre}" />
          </p:column>
          <p:column headerText="Municipio" filterBy="#{m.nombre}" filterMatchMode="contains" style="width: 250px;" filterStyle="width: 150px;">
            <h:outputText value="#{m.nombre}" />
          </p:column>
        </p:dataTable>
        <br />
        <br />
        Nombre para la zona:
        <br />
        <p:inputText value="#{zonasBean.nombreZona}" size="20" />
        <br />
        <br />
        Gestor asignado para esta zona:
        <br />
        <p:selectOneMenu value="#{zonasBean.gestorSeleccionado.idGestor}" style="width:200px">
          <f:selectItems value="#{zonasBean.listaGestores}" var="g" itemValue="#{g.idGestor}" itemLabel="#{g.usuario.nombreLogin}" />
        </p:selectOneMenu>
        <br />
        <br />
        <p:commandButton value="Crear zona" actionListener="#{zonasBean.crearZona()}" update=":growl" />
        &nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" immediate="true" actionListener="#{zonasBean.cancelar()}" />
      </h:form>
    </p:dialog>
    <p:dialog widgetVar="dlgZonas" header="Zonas disponibles actualmente" modal="true" resizable="false">
      <h:form id="listaZonasForm" >
        <p:contextMenu for="zonas" style="width:200px;">
          <p:menuitem value="Detalle zona" icon="ui-icon-search" actionListener="#{zonasBean.abrirDetalleZona(zonasBean.zonaSeleccionada)}" />
          <p:menuitem value="Eliminar zona" icon="ui-icon-close" actionListener="#{zonasBean.eliminarZona(zonasBean.zonaSeleccionada)}" update=":growl" />
        </p:contextMenu>
        <p:dataTable id="zonas" var="z" value="#{zonasBean.listaZonas}" emptyMessage="No existen zonas designadas en este despacho." rowKey="#{z.idZona}" selection="#{zonasBean.zonaSeleccionada}" selectionMode="single" paginator="true" rows="15" paginatorPosition="bottom" paginatorAlwaysVisible="false" style="width: 360px;">
          <p:column headerText="Nombre de la zona" style="width:200px;">
            <h:outputText value="#{z.nombre}" />
          </p:column>
          <p:column headerText="Gestor asignado" style="width:150px;">
            <h:outputText value="#{z.gestor.usuario.nombreLogin}" />
          </p:column>
          <f:facet name="footer">
            <p:commandButton value="Aceptar" oncomplete="PF('dlgZonas').hide();" />
          </f:facet>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <p:dialog widgetVar="detalleZonaDialog" header="Detalle zona" modal="true" resizable="false">
      <h:form id="detalleZonaForm" >
        <p:dataTable id="detalleZona" var="d" value="#{zonasBean.detalleZona}" emptyMessage="No existen municipios en esta zona." scrollable="true" scrollRows="10" style="width: 410px;">
          <p:column headerText="Municipios en la zona" style="width:200px;">
            <h:outputText value="#{d.nombre}" />
          </p:column>
          <p:column headerText="Estado" style="width:200px;">
            <h:outputText value="#{d.estadoRepublica.nombre}" />
          </p:column>
          <f:facet name="footer">
            <p:commandButton value="Aceptar" oncomplete="PF('detalleZonaDialog').hide();" />
          </f:facet>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </body>
</html>
