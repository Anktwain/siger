<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Marcaje</title>
  </h:head>
  <f:metadata>
    <f:event listener="#{indexBean.verificarAcceso('marcaje')}" type="preRenderView" />
  </f:metadata>
  <body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <!-- Overlay Div -->
    <div id="overlay" class="transparent" style="display: none"></div>
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Marcaje
          </li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Marcaje</h3>
          <span>Consulte informaci&oacute;n de las cuentas con marcaje.</span>
          <span>Habilite la impresion de visitas domiciliarias.</span>
        </div>
      </div>
      <div class="padding-md">
        <div class="col-lg-10">
          <h:form id="marcajeForm">
            <!-- SE COMENTA HASTA NUEVO AVISO -->
            <!--
            <hr />
            <p:commandButton value="Habilitar periodo de impresion" oncomplete="PF('dlgPeriodoImpresion').show();"/>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <p:commandButton value="Visualizar periodos activos" oncomplete="PF('dlgPeriodosActivos').show();"/>
            <br />
            <hr />
            <br />
            -->
            Seleccione un marcaje:
            &nbsp;&nbsp;&nbsp;&nbsp;
            <p:selectOneMenu value="#{marcajeBean.marcajeSeleccionado.idMarcaje}" style="width:200px">
              <f:selectItem itemLabel="Todos" itemValue="0" />
              <f:selectItems value="#{marcajeBean.listaMarcajes}" var="mar" itemLabel="#{mar.marcaje}" itemValue="#{mar.idMarcaje}" />
            </p:selectOneMenu>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{marcajeBean.prepararCreditos()}" update="tablaMarcaje" />
            <br />
            <br />
            <p:contextMenu for="tablaMarcaje" style="width:200px;">
              <p:menuitem value="Ver Detalle" icon="ui-icon-check" actionListener="#{marcajeBean.abrirDetalleCredito()}" />
              <p:menuitem value="Registrar devolucion" icon="ui-icon-alert" oncomplete="PF('dlgConfirmarDevolucionSepomex').show();" />
            </p:contextMenu>
            <p:dataTable id="tablaMarcaje" var="c" value="#{marcajeBean.listaCreditos}" emptyMessage="No existen creditos marcados." paginator="true" paginatorAlwaysVisible="false" rows="10" paginatorPosition="bottom" selection="#{marcajeBean.creditoSeleccionado}" selectionMode="single" rowKey="#{c.idCredito}" style="width:800px;">
              <p:column headerText="Credito" style="width:100px;"> 
                <h:outputText value="#{c.numeroCredito}"/>
              </p:column>
              <p:column headerText="Deudor" style="width:400px;"> 
                <h:outputText value="#{c.deudor.sujeto.nombreRazonSocial}"/>
              </p:column>
              <p:column headerText="Saldo vencido" style="width:100px;">
                <h:outputText value="#{c.monto}">
                  <f:convertNumber locale="es-MX" maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                </h:outputText>
              </p:column>
              <p:column headerText="Gestor actual" style="width:100px;"> 
                <h:outputText value="#{c.gestor.usuario.nombreLogin}"/>
              </p:column>
            </p:dataTable>
            <hr />
            <h:outputText value="Seleccione la bandeja de cuentas con errores en la direccion:" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            &nbsp;&nbsp;&nbsp;&nbsp;
            <p:selectOneMenu value="#{marcajeBean.marcajeSeleccionado.idMarcaje}" style="width:200px">
              <f:selectItem itemLabel="Todos" itemValue="0" />
              <f:selectItems value="#{marcajeBean.listaMarcajes}" var="mar" itemLabel="#{mar.marcaje}" itemValue="#{mar.idMarcaje}" />
            </p:selectOneMenu>
            <br />
            <h:outputText value="Aqui existira la bandeja de cuentas con probolemas en la direccion, es importante diseÃ±arla bien en la base de datos" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
          </h:form>
        </div>
      </div>
      <p:dialog widgetVar="dlgConfirmarDevolucionSepomex" header="Confirmar devolucion" modal="true" width="350">
        <h:form id="confirmarDevolucionSepomexForm">
          Esta seguro que desea confirmar la devolucion?
          <br />
          <br />
          Esto significa que correos de Mexico devolvio la correspondencia que envio a este deudor.
          <br />
          <br />
          <p:commandButton value="Confirmar" icon="ui-icon-check" actionListener="#{marcajeBean.quitarMarcaje()}" update=":growl" oncomplete="PF('dlgConfirmarDevolucionSepomex').hide();" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dlgConfirmarDevolucionSepomex').hide();" />
        </h:form>
      </p:dialog>
      <p:dialog widgetVar="dlgPeriodoImpresion" header="Establecer periodo" modal="true" width="370">
        <h:form id="periodoImpresionForm">
          Indique el periodo de impresion:
          <br />
          <br />
          Fecha inicio:
          &nbsp;
          <p:calendar value="#{marcajeBean.fechaInicioImpresiones}" showOn="button" required="true" requiredMessage="Debe indicar una fecha de inicio." style="width: 100px;" />
          <br />
          <br />
          Fecha fin:
          &nbsp;
          <p:calendar value="#{marcajeBean.fechaFinImpresiones}" showOn="button" required="true" requiredMessage="Debe indicar una fecha final." style="width: 100px;" />
          <br />
          <br />
          Rango para:
          &nbsp;
          <p:selectOneMenu value="#{marcajeBean.tipoImpresionSeleccionado}">
            <f:selectItems value="#{marcajeBean.tipoImpresion}" var="t" itemLabel="#{t}" itemValue="#{t}" />
          </p:selectOneMenu>
          <br />
          <br />
          ADVERTENCIA: Esta accion reemplazara al periodo actual de impresiones.
          <br />
          <br />
          <p:commandButton value="Confirmar" icon="ui-icon-check" actionListener="#{marcajeBean.establecerPeriodo()}" update=":growl" oncomplete="PF('dlgPeriodoImpresion').hide();" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dlgPeriodoImpresion').hide();" />
        </h:form>
      </p:dialog>
      <p:dialog widgetVar="dlgPeriodosActivos" header="Periodos activos" modal="true" width="250">
        <h:form id="periodosActivosForm">
          Periodo correo ordinario:
          <br />
          <h:outputText value="#{marcajeBean.periodoActivoSepomex}" />
          <br />
          <br />
          Periodo visita domiciliaria:
          <br />
          <h:outputText value="#{marcajeBean.periodoActivoVisitas}" />
          <br />
          <br />
          Periodo correo electronico:
          <br />
          <h:outputText value="#{marcajeBean.periodoActivoEmail}" />
          <br />
          <br />
          <div align="center">
            <p:commandButton value="Aceptar" icon="ui-icon-check" oncomplete="PF('dlgPeriodosActivos').hide();" />
          </div>
        </h:form>
      </p:dialog>
    </div><!-- /main-container -->
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </body>
</html>