<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
    <h:head>
        <meta charset="utf-8"></meta>
        <title>SigerWeb - Empresas</title>
        <link rel="shortcut icon" href="resources/img/iconos/icono1.ico" type="image/x-icon" />
    </h:head> 
    <h:body>
        <p:growl id="growl" showDetail="true" sticky="true" />
        <div id="overlay" class="transparent" style="display: none;"></div>
        <ui:include src="barraSuperior.xhtml" />
        <ui:include src="barraLateral.xhtml" />
        <div id="main-container">
            <div id="breadcrumb">
                <ul class="breadcrumb">
                    <li>
                        <i class="fa fa-home">
                        </i>
                        <a href="panelAdministrativo.xhtml">Inicio</a>
                    </li>
                    <li class="active">
                        Empresas
                    </li>
                </ul>
            </div>
            <div class="main-header clearfix">
              <div class="page-title">
                  <h3 class="no-margin">Empresas</h3>
                  <span>Consulte informaci&oacute;n de las empresas, registre a una nueva empresa, modifique o elimine las empresas registradas</span>
              </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-tab clearfix">
                    <ul class="tab-bar">
                      <li><a href="#nueva" data-toggle="tab" title="Click aqui si desea dar de alta una empresa"><h2><i class="fa fa-plus"></i> Nueva empresa</h2></a></li>
                      <li><a href="#editar" data-toggle="tab" title="Click aqui si desea editar una empresa que ya esta registrada en el sistema"><h2><i class="fa fa-pencil"></i> Editar empresa</h2></a></li>
                    </ul>
                </div>
                <div class="panel-body">
                    <div class="tab-content">
                        <div class="tab-pane fade" id="nueva">
                            <h:form id="formNuevaEmpresa">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4>Registre a una empresa en el sistema</h4>
                                    </div>
                                    <div class="modal-body">
                                        <!-- FORMULARIO PARA REGISTRAR UNA NUEVA EMPRESA -->
                                        <h:outputText value="Razon Social:" />
                                        <br />
                                        <p:inputText id="razon" value="#{empresasBean.nuevaRazonSocial}" size="50" required="true" requiredMessage="Debe ingresar una razon social" />
                                        <p:tooltip for="razon" value="Indique el nombre completo de la empresa incluyendo el tipo de sociedad de la que se trata" />
                                        <br />
                                        <h:outputText value="RFC:" />
                                        <br />
                                        <p:inputText id="errefece" value="#{empresasBean.nuevoRfc}" size="25" required="true" requiredMessage="Debe ingresar un RFC" />
                                        <p:tooltip for="errefece" value="Indique la clave del Registro Federal de Contribuyentes" />
                                        <br />
                                        <h:outputText value="Nombre Corto:" />
                                        <br />
                                        <p:inputText id="cortito" value="#{empresasBean.nuevoCorto}" size="25" required="true" requiredMessage="Debe ingresar un nombre corto de empresa" />
                                        <p:tooltip for="cortito" value="Indique un nombre clave para identificar a esta empresa" />
                                        <br />
                                        <p:separator />
                                        <h4>
                                            <h:outputText value="Agregue telefonos, correos y direcciones:" />
                                        </h4>
                                        <br />
                                        <p:commandButton id="btnTelsEmpresa" icon="fa fa-phone" type="button">
                                            <p:tooltip for="btnTelsEmpresa" value="Registre numeros telefonicos para esta empresa" />
                                            <p:overlayPanel id="pnlTelsEmpresa" for="btnTelsEmpresa" hideEffect="size" dynamic="true" style="width: 300px">
                                                Numero:
                                                <br />
                                                <p:inputText id="numero" required="true" requiredMessage="Ingrese un numero telefonico" value="#{empresasBean.nuevoNumero}" size="25" />
                                                <p:tooltip for="numero" value="Indique el numero de la empresa sin clave lada" />
                                                <br />
                                                Tipo:
                                                <br />
                                                <p:inputText id="tipo" value="#{empresasBean.nuevoTipoTel}" size="25" />
                                                <p:tooltip for="tipo" value="Indique si es un numero de casa, oficina, etc." />
                                                <br />
                                                Clave Lada:
                                                <br />
                                                <p:inputText id="lada" value="#{empresasBean.nuevaLada}" size="25" />
                                                <p:tooltip for="lada" value="Indique la clave lada del telefono proporcionado" />
                                                <br />
                                                Horario de llamadas:
                                                <br />
                                            <p:inputText id="hora" value="#{empresasBean.nuevoHorarioAtencionTel}" size="25" />
                                            <p:tooltip for="hora" value="Indique un horario de atencion para realizar llamadas" />
                                            </p:overlayPanel>
                                        </p:commandButton>
                                        <p:commandButton id="btnMailsEmpresa" icon="fa fa-envelope" type="button">
                                        <p:tooltip for="btnMailsEmpresa" value="Registre direcciones de correo para esta empresa" />
                                            <p:overlayPanel id="pnlMailsEmpresa" for="btnMailsEmpresa" hideEffect="size" dynamic="true" style="width: 350px">
                                                Correo electronico:
                                                <br />
                                                <p:inputText id="correo" required="true" requiredMessage="Ingrese una direccion de correo" value="#{empresasBean.nuevoCorreo}" size="35" />
                                                <p:tooltip for="correo" value="Indique el algun correo electronico de la empresa" />
                                            </p:overlayPanel>
                                        </p:commandButton>
                                        <p:commandButton id="btnDirsEmpresa" icon="fa fa-map-marker" actionListener="#{empresasBean.cargaEstados()}">
                                        <p:tooltip for="btnDirsEmpresa" value="Registre direcciones fisicas para esta empresa" />
                                            <p:overlayPanel id="pnlDirsEmpresa" for="btnDirsEmpresa" hideEffect="size" dynamic="true" style="width: 450px">
                                                Calle:
                                                <br />
                                                <p:inputText id="calle" required="true" requiredMessage="Ingrese una calle" value="#{empresasBean.nuevaCalle}" size="40" />
                                                <p:tooltip for="calle" value="Indique la calle donde se ubica la empresa" />
                                                <br />
                                                <br />
                                                Numero Exterior:
                                                &nbsp;
                                                <p:inputText id="ext" required="true" requiredMessage="Ingrese un numero exterior" value="#{empresasBean.nuevoExterior}" size="5" />
                                                <p:tooltip for="ext" value="Indique el numero exterior de la empresa" />
                                                &nbsp;&nbsp;
                                                Numero Interior:
                                                &nbsp;
                                                <p:inputText id="int" value="#{empresasBean.nuevoInterior}" size="5" />
                                                <p:tooltip for="int" value="Indique el numero interior, edificion, local, etc. de la empresa" />
                                                <br />
                                                <br />
                                                <h:form id="formCombos">
                                                    Estado:
                                                    &nbsp;
                                                    <p:selectOneMenu id="comboboxEstados" value="#{empresasBean.estado}" style="width:250px">
                                                        <p:ajax listener="#{empresasBean.cambioEstado()}" update="comboboxMunicipios" />
                                                        <f:selectItem itemLabel="Seleccione un estado" itemValue="" noSelectionOption="false" />
                                                        <f:selectItems value="#{empresasBean.conjuntoEstados}" />
                                                    </p:selectOneMenu>
                                                    <p:tooltip for="comboboxEstados" value="Indique en que estado de la republica se ubica la empresa" />
                                                    <br />
                                                    <br />
                                                    Municipio:
                                                    &nbsp;
                                                    <p:selectOneMenu id="comboboxMunicipios" value="#{empresasBean.municipio}" style="width:250px">
                                                        <f:selectItem itemLabel="Seleccione un municipio" itemValue="" noSelectionOption="false" />
                                                        <f:selectItems value="#{dropdownView.conjuntoMunicipios}" />
                                                    </p:selectOneMenu>
                                                    <p:tooltip for="comboboxMunicipios" value="Indique el municipio en el que se ubica la empresa" />
                                                </h:form>
                                            </p:overlayPanel>
                                        </p:commandButton>
                                        <p:commandButton id="btnContactosEmpresa" icon="fa fa-users" type="button">
                                            <p:tooltip for="btnContactosEmpresa" value="Registre contactos personales de la empresa" />
                                            <p:overlayPanel id="pnlContactosEmpresa" for="btnContactosEmpresa" hideEffect="size" dynamic="true" style="width: 300px">
                                            </p:overlayPanel>
                                        </p:commandButton>
                                        <br />
                                        <br />
                                        <p:commandButton id="creacion" value="Aceptar" actionListener="#{empresasBean.crearEmpresa}" update="growl" />
                                        <p:tooltip for="creacion" value="Click aqui para registrar a la empresa de manera definitiva" />
                                    </div>
                                    <div class="modal-footer">
                                    </div>
                                </div><!-- /.modal-content -->
                            </h:form>
                        </div>
                        <div class="tab-pane fade" id="editar">
                            <h:form id="formEditarEmpresa">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4>Seleccione la empresa y de click en "Editar"</h4>
                                    </div>
                                    <div class="modal-body">
                                        <p:dataTable id="editarEmpresa" var="sujeto" value="#{empresasBean.listaEmpresas}" rowKey="#{sujeto.rfc}" selection="#{empresasBean.empresa}" selectionMode="single" paginator="true" rows="10" style="width: 700px; margin-left: auto; margin-right: auto;">
                                            <f:facet name="header">
                                                Empresas registradas en el sistema
                                            </f:facet>
                                            <p:column headerText="Nombre de la empresa">
                                                <p:outputLabel value="#{sujeto.nombreRazonSocial}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                            </p:column>
                                            <p:column headerText="RFC"> 
                                                <h:outputText value="#{sujeto.rfc}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                            </p:column>
                                            <f:facet name="footer">
                                                <p:commandButton process="editarEmpresa" icon="ui-icon-pencil" value="Editar" actionListener="#{empresasBean.guardarEmpresa}" update="todo:modalEmpresaId" oncomplete="PF('modalEmpresa').show();" />
                                            </f:facet>
                                        </p:dataTable>
                                    </div>
                                    <div class="modal-footer">
                                    </div>
                                </div><!-- /.modal-content -->
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /main-container -->
        <!-- Footer ================================================== -->
        <ui:include src="barraInferior.xhtml" />
        <!-- DIALOGOS -->
        <!-- DIALOGO DE DETALLE EMPRESA -->
        <h:form id="todo">
            <p:dialog id="modalEmpresaId" header="Detalle empresa" widgetVar="modalEmpresa" modal="true" resizable="false">
                <h:form>
                    <div class="panel panel-default">
                        <div class="panel-tab clearfix">
                            <ul class="tab-bar">
                                <li><a href="#editaDatos" data-toggle="tab"><i class="fa fa-briefcase"></i> Editar datos primarios</a></li>
                                <li><a href="#editaProductos" data-toggle="tab"><i class="fa fa-barcode"></i> Editar productos</a></li>
                                <li><a href="#editaSubproductos" data-toggle="tab"><i class="fa fa-barcode"></i> Editar subproductos</a></li>
                                <li><a href="#eliminaEmpresa" data-toggle="tab"><i class="fa fa-trash-o"></i> Eliminar empresa</a></li>
                            </ul>
                        </div>
                        <div class="panel-body">
                            <div class="tab-content">
                                <div class="tab-pane fade" id="editaDatos">
                                    <!--
                                    EDICION DE DATOS PRIMARIOS
                                    -->
                                    <h:outputText value="Razon Social:" />
                                    <br />
                                    <p:inputText value="#{empresasBean.razonSocial}" size="50" required="true" requiredMessage="Debe ingresar una razon social" />
                                    <br />
                                    <h:outputText value="RFC:" />
                                    <br />
                                    <p:inputText value="#{empresasBean.auxRfc}" size="25" required="true" requiredMessage="Debe ingresar un RFC" />
                                    <br />
                                    <h:outputText value="Nombre Corto:" />
                                    <br />
                                    <p:inputText value="#{empresasBean.corto}" size="25" required="true" requiredMessage="Debe ingresar un nombre corto de empresa" />
                                    <br />
                                    <br />
                                    <p:commandButton value="Aceptar" actionListener="#{empresasBean.editarEmpresa()}" update="growl" />
                                </div>
                                <div class="tab-pane fade" id="editaProductos">
                                    <!--
                                    EDICION DE PRODUCTOS
                                    -->
                                    <p:dataTable id="editarProducto" var="producto" value="#{empresasBean.listaProductos}" rowKey="#{producto.idProducto}" selection="#{empresasBean.producto}" selectionMode="single" paginator="true" rows="10" emptyMessage="No hay productos registrados." style="width: 620px;">
                                        <f:facet name="header">
                                            Productos de <p:outputLabel value="#{empresasBean.razonSocial}" />
                                        </f:facet>
                                        <p:column headerText="Nombre del producto" style="width: 150px;">
                                            <p:outputLabel value="#{producto.nombre}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                        </p:column>
                                        <p:column headerText="Descripcion" style="width: 450px;"> 
                                            <h:outputText value="#{producto.descripcion}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton process="editarProducto" icon="ui-icon-pencil" value="Editar" actionListener="#{empresasBean.guardarProducto}" oncomplete="PF('modalProducto').show();" />
                                            <p:commandButton process="editarProducto" icon="ui-icon-plus" value="Agregar" oncomplete="PF('nuevoProducto').show();" />
                                        </f:facet>
                                    </p:dataTable>
                                </div>
                                <!--
                                    EDICION DE SUBPRODUCTOS
                                -->
                                <div class="tab-pane fade" id="editaSubproductos">
                                    <p:dataTable id="editarSubproducto" var="subproducto" value="#{empresasBean.listaSubproductos}" rowKey="#{subproducto.idSubproducto}" selection="#{empresasBean.subproduct}" selectionMode="single" paginator="true" rows="10" emptyMessage="No hay subproductos registrados." style="width: 620px;">
                                        <f:facet name="header">
                                            Subproductos de <p:outputLabel value="#{empresasBean.razonSocial}" />
                                        </f:facet>
                                        <p:column headerText="Nombre del subproducto" style="width: 150px;">
                                            <p:outputLabel value="#{subproducto.nombre}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                        </p:column>
                                        <p:column headerText="Descripcion" style="width: 450px;"> 
                                            <h:outputText value="#{subproducto.descripcion}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton process="editarSubproducto" icon="ui-icon-pencil" value="Editar" actionListener="#{empresasBean.guardarSubproducto}" oncomplete="PF('modalSubproducto').show();" />
                                            <p:commandButton process="editarSubproducto" icon="ui-icon-plus" value="Agregar" oncomplete="PF('nuevoSubproducto').show();" />
                                        </f:facet>
                                    </p:dataTable>
                                </div>
                                <div class="tab-pane fade" id="eliminaEmpresa">
                                    <!--
                                    ELIMINAR A LA EMPRESA
                                    -->
                                    <h:outputText value="Esta seguro de que desea eliminar a esta empresa?" />
                                    <br />
                                    <br />
                                    <p:commandButton value="Eliminar" actionListener="#{empresasBean.eliminarEmpresa}" oncomplete="PF('modalEmpresa').hide();" />
                                    <p:commandButton value="Cancelar" oncomplete="PF('modalEmpresa').hide();" />
                                </div>
                            </div>
                        </div>
                    </div>
                </h:form>
            </p:dialog>
            <!-- DIALOGO DE DETALLE PRODUCTO -->
            <p:dialog id="modalProductoId" header="Detalle producto" widgetVar="modalProducto" modal="false" resizable="false" draggable="false" >
                <h:outputText value="Nombre del producto:" />
                <br />
                <p:inputText value="#{empresasBean.prod}" size="50" />
                <br />
                <h:outputText value="Descripcion:" />
                <br />
                <p:inputTextarea value="#{empresasBean.desc}" rows="10" cols="50" />
                <br />
                <br />
                <p:commandButton value="Aceptar" actionListener="#{empresasBean.editarProducto}" oncomplete="PF('modalProducto').hide();" />
            </p:dialog>
            <!-- DIALOGO DE DETALLE SUBPRODUCTO -->
            <p:dialog id="modalSubproductoId" header="Detalle subproducto" widgetVar="modalSubproducto" modal="false" resizable="false" draggable="false" >
                <h:outputText value="Nombre del subproducto:" />
                <br />
                <p:inputText value="#{empresasBean.subprod}" size="50" />
                <br />
                <h:outputText value="Descripcion:" />
                <br />
                <p:inputTextarea value="#{empresasBean.subdesc}" rows="10" cols="50" />
                <br />
                <br />
                <p:commandButton value="Aceptar" actionListener="#{empresasBean.editarSubproducto}" oncomplete="PF('modalSubproducto').hide();" />
            </p:dialog>
            <!-- DIALOGO DE NUEVO PRODUCTO -->
            <p:dialog id="modalNuevoProducto" header="Nuevo producto" widgetVar="nuevoProducto" modal="false" resizable="false" draggable="false" >
                <h:outputText value="Nombre del producto:" />
                <br />
                <p:inputText value="#{empresasBean.nuevoProd}" size="50" />
                <br />
                <h:outputText value="Descripcion:" />
                <br />
                <p:inputTextarea value="#{empresasBean.nuevaDesc}" rows="10" cols="50" />
                <br />
                <br />
                <p:commandButton value="Aceptar" actionListener="#{empresasBean.crearProducto}" oncomplete="PF('nuevoProducto').hide();" />
            </p:dialog>
            <!-- DIALOGO DE NUEVO SUBPRODUCTO -->
            <p:dialog id="modalNuevoSubproducto" header="Nuevo subproducto" widgetVar="nuevoSubproducto" modal="false" resizable="false" draggable="false" >
                <h:outputText value="Nombre del subproducto:" />
                <br />
                <p:inputText value="#{empresasBean.nuevoSubprod}" size="50" />
                <br />
                <h:outputText value="Descripcion:" />
                <br />
                <p:inputTextarea value="#{empresasBean.nuevaSubdesc}" rows="10" cols="50" />
                <br />
                <h:outputText value="Seleccione el producto al que pertenece" />
                <br />
                <p:selectOneMenu id="combobox" value="#{empresasBean.seleccionadoCombobox}">
                    <f:selectItem itemLabel="Seleccione un producto" itemValue="" />
                    <f:selectItems value="#{empresasBean.listaProductos}" var="producto" itemLabel="#{producto.nombre}" itemValue="#{producto.idProducto}" />
                </p:selectOneMenu>
                <br />
                <br />
                <p:commandButton value="Aceptar" actionListener="#{empresasBean.crearSubproducto}" oncomplete="PF('nuevoSubproducto').hide();" />
            </p:dialog>
        </h:form>
    </h:body>
</html>