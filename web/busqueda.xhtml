<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Busqueda</title>
  </h:head>
  <f:metadata>
    <f:event listener="#{indexBean.verificarAcceso('busqueda')}" type="preRenderView" />
  </f:metadata>
  <body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Busqueda avanzada
          </li>
        </ul>
      </div>
      <div class="page-title">
        <div class="main-header clearfix">
          <h3 class="no-margin">Busqueda avanzada de creditos en el sistema</h3>
          <br />
          <span>Obtenga un listado de creditos aplicando los filtros deseados.</span>
          <br />
          <span>Puede filtrar utilizando criterios como zona, saldo vencido entre otros.</span>
        </div>
      </div>
      <hr class="no-margin" />
      <div class="padding-md">
        <h:form id="busquedasForm">
          <p:accordionPanel style="width: 1200px" activeIndex="-1">
            <p:tab title="Busqueda por zona">
              Seleccione la zona en la cual quiere buscar creditos:
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu value="#{busquedaBean.zonaSeleccionada.idZona}">
                <f:selectItems value="#{busquedaBean.listaZonas}" var="z" itemLabel="#{z.nombre}" itemValue="#{z.idZona}" />
              </p:selectOneMenu>
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busquedaBean.obtenerCreditosPorZona()}" update="busquedaPorZona" />
              <br />
              <br />
              <p:contextMenu for="busquedaPorZona" style="width:200px;">
                <p:menuitem value="Ver detalle" icon="ui-icon-check" actionListener="#{busquedaBean.abrirDetalleCreditoDireccion()}" />
                <p:menuitem value="Ver en Google Maps ®" icon="ui-icon-flag" actionListener="#{busquedaBean.obtenerDireccionCredito()}" />
              </p:contextMenu>
              <p:dataTable id="busquedaPorZona" var="c1" value="#{busquedaBean.listaCreditos}" selection="#{busquedaBean.creditoDireccionSeleccionado}" selectionMode="single" rowKey="#{c1.numeroCredito}" emptyMessage="No existen creditos en la zona seleccionada." paginator="true" rows="15" paginatorPosition="bottom">
                <p:column headerText="Credito" style="width:300px;">
                  <h:outputText value="#{c1.numeroCredito}" />
                  <br />
                  <h:outputText value="#{c1.nombreDeudor}" />
                </p:column>
                <p:column headerText="Institucion" style="width:100px;">
                  <h:outputText value="#{c1.institucion}" />
                </p:column>
                <p:column headerText="Gestor" style="width:100px;">
                  <h:outputText value="#{c1.gestorActual}" />
                </p:column>
                <p:column headerText="Calle y numero" style="width:200px;">
                  <h:outputText value="#{c1.calleNumero}" />
                </p:column>
                <p:column headerText="Colonia y C.P." style="width:200px;">
                  <h:outputText value="#{c1.colonia} (#{c.cp})" />
                </p:column>
                <p:column headerText="Municipio y estado" style="width:200px;">
                  <h:outputText value="#{c1.municipio}, #{c.estado}" />
                </p:column>
                <f:facet name="footer">
                  <p:commandButton value="Gestionar como campaña" icon="ui-icon-bookmark" actionListener="#{busquedaBean.generarCampanaCreditosDireccion(busquedaBean.listaCreditos)}" />
                </f:facet>
              </p:dataTable>
            </p:tab>
            <p:tab title="Busqueda por area geografica">
              Estado:
              &nbsp;&nbsp;
              <p:selectOneMenu value="#{busquedaBean.estadoSeleccionado.idEstado}" style="width: 200px;">
                <f:selectItem itemLabel="" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaEstados}" var="e" itemLabel="#{e.nombre}" itemValue="#{e.idEstado}" />
                <p:ajax listener="#{busquedaBean.obtenerMunicipios(busquedaBean.estadoSeleccionado)}" update="comboboxMunicipiosBusqueda" />
              </p:selectOneMenu>
              <br />
              <br />
              Municipio:
              &nbsp;&nbsp;
              <p:selectOneMenu id="comboboxMunicipiosBusqueda" value="#{busquedaBean.municipioSeleccionado.idMunicipio}" filter="true" filterMatchMode="contains" style="width: 200px;">
                <f:selectItem itemLabel="" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaMunicipios}" var="m" itemLabel="#{m.nombre}" itemValue="#{m.idMunicipio}"/>
              </p:selectOneMenu>
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busquedaBean.obtenerCreditosPorAreaGeografica()}" update=":growl, busquedaPorArea" />
              <br />
              <br />
              <p:contextMenu for="busquedaPorArea" style="width:200px;">
                <p:menuitem value="Ver detalle" icon="ui-icon-check" actionListener="#{busquedaBean.abrirDetalleCreditoDireccion()}" />
              </p:contextMenu>
              <p:dataTable id="busquedaPorArea" var="c2" value="#{busquedaBean.listaCreditos}" selection="#{busquedaBean.creditoDireccionSeleccionado}" selectionMode="single" rowKey="#{c2.numeroCredito}" emptyMessage="No existen creditos en la zona seleccionada." paginator="true" rows="15" paginatorPosition="bottom">
                <p:column headerText="Credito" style="width:300px;">
                  <h:outputText value="#{c2.numeroCredito}" />
                  <br />
                  <h:outputText value="#{c2.nombreDeudor}" />
                </p:column>
                <p:column headerText="Institucion" style="width:100px;">
                  <h:outputText value="#{c2.institucion}" />
                </p:column>
                <p:column headerText="Gestor" style="width:100px;">
                  <h:outputText value="#{c2.gestorActual}" />
                </p:column>
                <p:column headerText="Calle y numero" style="width:200px;">
                  <h:outputText value="#{c2.calleNumero}" />
                </p:column>
                <p:column headerText="Colonia y C.P." style="width:200px;">
                  <h:outputText value="#{c2.colonia} (#{c2.cp})" />
                </p:column>
                <p:column headerText="Municipio y estado" style="width:200px;">
                  <h:outputText value="#{c2.municipio}, #{c2.estado}" />
                </p:column>
                <f:facet name="footer">
                  <p:commandButton value="Gestionar como campaña" icon="ui-icon-bookmark" actionListener="#{busquedaBean.generarCampanaCreditosDireccion(busquedaBean.listaCreditos)}" />
                </f:facet>
              </p:dataTable>
            </p:tab>
            <p:tab title="Busqueda por saldo vencido">
              Introduzca el rango en el que se buscara
              <p:inputText value="#{busquedaBean.saldoInferior}" type="number" style="width: 100px;" /> &lt; Saldo vencido &lt; <p:inputText value="#{busquedaBean.saldoSuperior}" type="number" style="width: 100px;" />
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busquedaBean.obtenerCreditosPorSaldoVencido()}" update="busquedaPorSaldoVencido" />
              <br />
              <br />
              <p:contextMenu for="busquedaPorSaldoVencido" style="width:200px;">
                <p:menuitem value="Ver Detalle" icon="ui-icon-check" actionListener="#{busquedaBean.abrirDetalleCredito()}" />
              </p:contextMenu>
              <p:dataTable id="busquedaPorSaldoVencido" var="c3" value="#{busquedaBean.listaCreditos2}" rowKey="#{c3.idCredito}" selection="#{busquedaBean.creditoSeleccionado}" selectionMode="single" emptyMessage="No existen creditos con este rango de saldo vencido." paginator="true" rows="15" paginatorPosition="bottom">
                <p:column headerText="Credito" style="width:100px;">
                  <h:outputText value="#{c3.numeroCredito}" />
                </p:column>
                <p:column headerText="Deudor" style="width:400px;">
                  <h:outputText value="#{c3.deudor.sujeto.nombreRazonSocial}" />
                </p:column>
                <p:column headerText="Institucion" style="width:100px;">
                  <h:outputText value="#{c3.producto.institucion.nombreCorto}" />
                </p:column>
                <p:column headerText="Gestor" style="width:100px;">
                  <h:outputText value="#{c3.gestor.usuario.nombreLogin}" />
                </p:column>
                <p:column headerText="Saldo vencido" style="width:100px;">
                  <h:outputText value="#{busquedaBean.obtenerSaldoVencido(c3.idCredito)}">
                    <f:convertNumber type="currency" currencySymbol="$" />
                  </h:outputText>
                </p:column>
              </p:dataTable>
              <f:facet name="footer">
                <p:commandButton value="Gestionar como campaña" icon="ui-icon-bookmark" actionListener="#{busquedaBean.generarCampana(busquedaBean.listaCreditos2)}" />
              </f:facet>
            </p:tab>
            <p:tab title="Busqueda por tiempo con adeudo">
              Elija la cantidad de meses vencidos
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu value="#{busquedaBean.mesesVencidos}">
                <f:selectItem itemLabel="1" itemValue="1" />
                <f:selectItem itemLabel="2" itemValue="2" />
                <f:selectItem itemLabel="3" itemValue="3" />
                <f:selectItem itemLabel="4" itemValue="4" />
                <f:selectItem itemLabel="5" itemValue="5" />
                <f:selectItem itemLabel="6" itemValue="6" />
                <f:selectItem itemLabel="7" itemValue="7" />
                <f:selectItem itemLabel="8" itemValue="8" />
                <f:selectItem itemLabel="9" itemValue="9" />
                <f:selectItem itemLabel="10" itemValue="10" />
                <f:selectItem itemLabel="11" itemValue="11" />
                <f:selectItem itemLabel="12" itemValue="12" />
              </p:selectOneMenu>
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busquedaBean.obtenerCreditosPorMesesVencidos()}" update="busquedaPorMesesVencidos" />
              <br />
              <br />
              <p:contextMenu for="busquedaPorMesesVencidos" style="width:200px;">
                <p:menuitem value="Ver Detalle" icon="ui-icon-check" actionListener="#{busquedaBean.abrirDetalleCredito()}" />
              </p:contextMenu>
              <p:dataTable id="busquedaPorMesesVencidos" var="c4" value="#{busquedaBean.listaCreditos2}" rowKey="#{c4.idCredito}" selection="#{busquedaBean.creditoSeleccionado}" selectionMode="single" emptyMessage="No existen creditos con este tiempo de vencimiento." paginator="true" rows="15" paginatorPosition="bottom">
                <p:column headerText="Credito" style="width:100px;">
                  <h:outputText value="#{c4.numeroCredito}" />
                </p:column>
                <p:column headerText="Deudor" style="width:400px;">
                  <h:outputText value="#{c4.deudor.sujeto.nombreRazonSocial}" />
                </p:column>
                <p:column headerText="Institucion" style="width:100px;">
                  <h:outputText value="#{c4.producto.institucion.nombreCorto}" />
                </p:column>
                <p:column headerText="Gestor" style="width:100px;">
                  <h:outputText value="#{c4.gestor.usuario.nombreLogin}" />
                </p:column>
                <p:column headerText="Saldo vencido" style="width:100px;">
                  <h:outputText value="#{busquedaBean.obtenerSaldoVencido(c4.idCredito)}">
                    <f:convertNumber type="currency" currencySymbol="$" />
                  </h:outputText>
                </p:column>
                <p:column headerText="Meses vencidos" style="width:100px;">
                  <h:outputText value="#{busquedaBean.obtenerMesesVencidos(c4.idCredito)}" />
                </p:column>
                <f:facet name="footer">
                  <p:commandButton value="Gestionar como campaña" icon="ui-icon-bookmark" actionListener="#{busquedaBean.generarCampana(busquedaBean.listaCreditos2)}" />
                </f:facet>
              </p:dataTable>
            </p:tab>
            <p:tab title="Busqueda por institucion/producto/campana">
              Seleccione la institucion de la que quiere obtener los creditos:
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu value="#{busquedaBean.institucionSeleccionada.idInstitucion}">
                <f:selectItem itemLabel="" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaInstituciones}" var="i" itemLabel="#{i.sujeto.nombreRazonSocial}" itemValue="#{i.idInstitucion}" />
                <p:ajax update="productoBusqueda" listener="#{busquedaBean.preparaProductos()}" />
              </p:selectOneMenu>
              <br />
              <br />
              Seleccione el producto:
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu id="productoBusqueda" value="#{busquedaBean.productoSeleccionado.idProducto}">
                <f:selectItem itemLabel="Todos" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaProductos}" var="p" itemLabel="#{p.nombre}" itemValue="#{p.idProducto}" />
                <p:ajax update="subproductoBusqueda" listener="#{busquedaBean.preparaSubproductos()}" />
              </p:selectOneMenu>
              <br />
              <br />
              Seleccione el subproducto:
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu id="subproductoBusqueda" value="#{busquedaBean.subproductoSeleccionado.idSubproducto}">
                <f:selectItem itemLabel="Todos" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaSubproductos}" var="s" itemLabel="#{s.nombre}" itemValue="#{s.idSubproducto}" />
              </p:selectOneMenu>
              <br />
              <br />
              Seleccione la campaña:
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu id="campanaBusqueda" value="#{busquedaBean.campanaSeleccionada.idCampana}">
                <f:selectItem itemLabel="Todas" itemValue="0" />
                <f:selectItems value="#{busquedaBean.listaCampanas}" var="ca" itemLabel="#{ca.nombre}" itemValue="#{ca.idCampana}" />
              </p:selectOneMenu>
              <br />
              <br />
              Seleccione la frecuencia de gestion (color):
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu value="#{busquedaBean.colorSeleccionado}" style="width:300px">
                <f:selectItem itemLabel="Todos" itemValue="0" />
                <f:selectItem itemLabel="Verde (Hace menos de 3 dias)" itemValue="Verde" />
                <f:selectItem itemLabel="Amarillo (Hace mas de 3 y menos de 7 dias)" itemValue="Amarillo" />
                <f:selectItem itemLabel="Rojo (Hace mas de 7 dias)" itemValue="Rojo" />
              </p:selectOneMenu>
              <br />
              <br />
              <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busquedaBean.obtenerCreditosPorProductosCampana()}" update=":growl, busquedaPorProducto" />
              <br />
              <br />
              <p:contextMenu for="busquedaPorProducto" style="width:200px;">
                <p:menuitem value="Ver Detalle" icon="ui-icon-check" actionListener="#{busquedaBean.abrirDetalleCredito()}" />
              </p:contextMenu>
              <p:dataTable id="busquedaPorProducto" var="c5" value="#{busquedaBean.listaCreditos2}" rowKey="#{c5.idCredito}" selection="#{busquedaBean.creditoSeleccionado}" selectionMode="single" emptyMessage="No existen creditos con los criterios seleccionados." paginator="true" rows="15" paginatorPosition="bottom">
                <p:column headerText="Credito" style="width:100px;">
                  <h:outputText value="#{c5.numeroCredito}" />
                </p:column>
                <p:column headerText="Deudor" style="width:400px;">
                  <h:outputText value="#{c5.deudor.sujeto.nombreRazonSocial}" />
                </p:column>
                <p:column headerText="Institucion" style="width:100px;">
                  <h:outputText value="#{c5.producto.institucion.nombreCorto}" />
                </p:column>
                <p:column headerText="Subproducto" style="width:200px;">
                  <h:outputText value="#{c5.subproducto.nombre}" />
                </p:column>
                <p:column headerText="Gestor" style="width:100px;">
                  <h:outputText value="#{c5.gestor.usuario.nombreLogin}" />
                </p:column>
                <f:facet name="footer">
                  <p:commandButton value="Gestionar como campaña" icon="ui-icon-bookmark" actionListener="#{busquedaBean.generarCampana(busquedaBean.listaCreditos2)}" />
                </f:facet>
              </p:dataTable>
            </p:tab>
          </p:accordionPanel>
        </h:form>
      </div>  
    </div><!-- /main-container -->
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </body>
  <!-- DIALOGO BARRA DE CARGA -->
  <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
  <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false" >
    <p:graphicImage library="img" name="loadingBarra.gif" />
  </p:dialog>
  <!-- DIALOGO DETALLE DE DIRECCIONES -->
  <p:dialog widgetVar="dlgDetalleDirecciones" modal="true" resizable="false" header="Direccion del credito" >
    <h:form id="detalleDireccionesForm">
      <h:outputText value="#{busquedaBean.direccionCredito.calle.toLowerCase()}" />
      <br />
      <br />
      <h:outputText value="#{busquedaBean.direccionCredito.colonia.nombre} (#{busquedaBean.direccionCredito.colonia.codigoPostal})" />
      <br />
      <br />
      <h:outputText value="#{busquedaBean.direccionCredito.municipio.nombre}" />
      <br />
      <br />
      <h:outputText value="#{busquedaBean.direccionCredito.estadoRepublica.nombre}" />
      <br />
    </h:form>
  </p:dialog>
</html>