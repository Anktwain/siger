<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Instituciones</title>
    <link rel="shortcut icon" href="resources/img/iconos/icono1.ico" type="image/x-icon" />
  </h:head> 
  <h:body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <div id="overlay" class="transparent" style="display: none;"></div>
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Instituciones
          </li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Instituciones</h3>
          <span>Consulte informaci&oacute;n de las instituciones, registre a una nueva, modifique o elimine las instituciones registradas</span>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="padding-md">
          <div class="col-sm-6 col-md-3">
            <h:form id="botonesInstitucionForm">
              <div class="panel-stat3 bg-danger">
                <h3 class="m-top-none">Nueva empresa</h3>
                <div id="botonazo">
                  <p:commandButton value="Agregar" class="btn btn-default" oncomplete="PF('dlgNuevaEmpresa').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-plus fa-2x" />
                </div>
              </div>
              <div class="panel-stat3 bg-info">
                <h3 class="m-top-none">Editar empresa</h3>
                <div id="botonazo">
                  <p:commandButton value="Editar" class="btn btn-default" oncomplete="PF('dlgEditarEmpresa').show();" />
                </div>
                <div class="stat-icon">
                  <i class="fa fa-pencil fa-2x" />
                </div>
              </div>
            </h:form>
          </div>
        </div>
      </div>
    </div><!-- /main-container -->
    <ui:include src="barraInferior.xhtml" /><!-- Footer -->
    <!-- DIALOGOS -->
    <!-- DIALOGO DE NUEVA EMPRESA -->
    <p:dialog widgetVar="dlgNuevaEmpresa" width="40%" header="Agregar una empresa" modal="true" resizable="false">
      <h:form id="formNuevaEmpresa">
        <div class="modal-header">
          <h4>Registre a una empresa en el sistema</h4>
        </div>
        <div class="modal-body">
          <!-- FORMULARIO PARA REGISTRAR UNA NUEVA EMPRESA -->
          <h:outputText value="Razon Social:" />
          <br />
          <p:inputText id="razon" value="#{institucionesBean.nombreRazonSocial}" size="50" required="true" requiredMessage="Debe ingresar una razon social" />
          <p:tooltip for="razon" value="Indique el nombre completo de la empresa incluyendo el tipo de sociedad de la que se trata" />
          <br />
          <h:outputText value="RFC:" />
          <br />
          <p:inputText id="errefece" value="#{institucionesBean.rfc}" size="12" required="true" requiredMessage="Debe ingresar un RFC" />
          <p:tooltip for="errefece" value="Indique la clave del Registro Federal de Contribuyentes" />
          <br />
          <h:outputText value="Nombre Corto:" />
          <br />
          <p:inputText id="cortito" value="#{institucionesBean.nombrecorto}" size="20" required="true" requiredMessage="Debe ingresar un nombre corto para la empresa" />
          <p:tooltip for="cortito" value="Indique un nombre clave para identificar a esta empresa" />
          <br />
          <!-- AREA DE BOTONES PARA AGREGAR DATOS ADICIONALES DE LA EMPRESA -->
          <!-- PROXIMAMENTE -->
        </div>
        <div class="modal-footer" style="text-align: left;">
          <p:commandButton id="creacion" value="Aceptar" actionListener="#{institucionesBean.crearInstitucion()}" update=":growl" />
          <p:tooltip for="creacion" value="Click aqui para registrar a la empresa de manera definitiva" />
        </div>
      </h:form>
    </p:dialog>
    <!-- DIALOGO DE EDITAR EMPRESAS -->
    <p:dialog widgetVar="dlgEditarEmpresa" header="Editar una empresa" modal="true" resizable="false" style="width: 850px">
      <h:form id="editarEmpresasForm">
        <div class="modal-header">
          <h4>Seleccione la empresa y de click en "Editar"</h4>
        </div>
        <br />
        <!-- TABLA CON LAS EMPRESAS REGISTRADAS EN EL SISTEMA -->
        <p:contextMenu for="tablaEmpresas" style="width:220px;">
          <p:menuitem value="Editar datos primarios" icon="ui-icon-pencil" actionListener="#{institucionesBean.controlDialogosDatosPrimarios()}" update=":growl" />
          <p:menuitem value="Editar productos" icon="ui-icon-plus" actionListener="#{institucionesBean.controlDialogosProductos()}" update=":growl" />
        </p:contextMenu>
        <p:dataTable id="tablaEmpresas" var="i" value="#{institucionesBean.listaInstituciones}" rowKey="#{i.idInstitucion}" selection="#{institucionesBean.institucionSeleccionada}" selectionMode="multiple" emptyMessage="No existen institucones para este despacho."  paginator="true" rows="15" paginatorPosition="bottom" style="width: 800px;">
          <p:column headerText="Razon social" style="width:350px;" > 
            <h:outputText value="#{i.sujeto.nombreRazonSocial}"/>
          </p:column>
          <p:column headerText="RFC" style="width:150px;" > 
            <h:outputText value="#{i.sujeto.rfc}"/>
          </p:column>
          <p:column headerText="Nombre clave" style="width:150px;" > 
            <h:outputText value="#{i.nombreCorto}"/>
          </p:column>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <!-- EDICION DE DATOS PRIMARIOS -->
    <p:dialog widgetVar="dlgDatosPrimariosEmpresa" header="Modifique datos de la empresa" modal="true" resizable="false" style="width: 500px">
      <h:form id="editarEmpresaForm">
        <h:outputText value="Razon Social:" />
        <br />
        <p:inputText value="#{institucionesBean.seleccionada.sujeto.nombreRazonSocial}" size="50" required="true" requiredMessage="Debe ingresar una razon social" />
        <br />
        <h:outputText value="RFC:" />
        <br />
        <p:inputText value="#{institucionesBean.seleccionada.sujeto.rfc}" size="25" required="true" requiredMessage="Debe ingresar un RFC" />
        <br />
        <h:outputText value="Nombre Corto:" />
        <br />
        <p:inputText value="#{institucionesBean.seleccionada.nombreCorto}" size="25" required="true" requiredMessage="Debe ingresar un nombre corto de empresa" />
        <br />
        <br />
        <p:commandButton value="Aceptar" actionListener="#{institucionesBean.editarInstitucion()}" update=":growl" />
        <br />
      </h:form>
    </p:dialog>
    <!-- TABLA CON LOS PRODUCTOS -->
    <p:dialog widgetVar="dlgEditarProductosEmpresa" header="Modifique o agregue productos a la empresa" modal="true" resizable="false" style="width: 600px">
      <h:form id="editarProductosForm">
        <p:contextMenu for="tablaEditarProductos" style="width:220px;">
          <p:menuitem value="Editar" icon="ui-icon-pencil" actionListener="#{institucionesBean.controlDialogosEditarProducto()}" update=":growl" />
          <p:menuitem value="Ver subproductos" icon="ui-icon-note" actionListener="#{institucionesBean.controlDialogosSubproductos()}" update=":growl" />
        </p:contextMenu>
        <p:dataTable id="tablaEditarProductos" var="producto" value="#{institucionesBean.listaProductos}" rowKey="#{producto.idProducto}" selection="#{institucionesBean.productoSeleccionado}" selectionMode="multiple" paginator="true" rows="10" emptyMessage="No hay productos registrados." style="width: 600px;">
          <f:facet name="header">
            Lista de productos registrados de <h:outputText value="#{institucionesBean.seleccionada.sujeto.nombreRazonSocial}" />
          </f:facet>
          <p:column headerText="Nombre del producto" style="width: 150px;">
            <p:outputLabel value="#{producto.nombre}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
          </p:column>
          <p:column headerText="Descripcion" style="width: 400px;"> 
            <h:outputText value="#{producto.descripcion}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
          </p:column>
          <f:facet name="footer">
            <p:commandButton icon="ui-icon-plus" value="Agregar un producto" actionListener="#{institucionesBean.controlDialogosNuevoProducto()}" />
          </f:facet>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <!-- EDICION DE PRODUCTO -->
    <p:dialog widgetVar="dlgEditarProducto" header="Editar datos del producto" modal="true" resizable="false" style="width: 300px">
      <h:form id="editarProductoForm">
        <h:outputText value="Nombre:" />
        <br />
        <p:inputText value="#{institucionesBean.seleccionado.nombre}" size="50" required="true" requiredMessage="Debe ingresar un nombre" />
        <br />
        <h:outputText value="Descripcion:" />
        <br />
        <p:inputTextarea value="#{institucionesBean.seleccionado.descripcion}" cols="50" rows="3" required="true" requiredMessage="Debe ingresar una descripcion" />
        <br />
        <br />
        <p:commandButton value="Aceptar" actionListener="#{institucionesBean.editarProducto()}" update=":growl" />
        <br />
      </h:form>
    </p:dialog>
    <!-- NUEVO PRODUCTO -->
    <p:dialog widgetVar="dlgNuevoProducto" header="Agregar un producto" modal="true" resizable="false" style="width: 300px">
      <!-- FORMULARIO PARA REGISTRAR UN NUEVO PRODUCTO -->
      <h:form id="nuevoProductoForm">
        <h:outputText value="Nombre del producto:" />
        <br />
        <p:inputText id="nombreProducto" value="#{institucionesBean.nombreProducto}" size="50" required="true" requiredMessage="Debe ingresar un nombre" />
        <p:tooltip for="nombreProducto" value="Indique el nombre completo del producto" />
        <br />
        <h:outputText value="Descripcion:" />
        <br />
        <p:inputTextarea id="descripcionProducto" value="#{institucionesBean.descripcionProducto}" cols="50" rows="3" required="true" requiredMessage="Debe ingresar una descripcion" />
        <p:tooltip for="descripcionProducto" value="Indique una breve descripcion para el producto" />
        <br />
        <p:commandButton id="creacionProducto" value="Aceptar" actionListener="#{institucionesBean.crearProducto()}" update=":growl, editarProductosForm:tablaEditarProductos" />
        <p:tooltip for="creacionProducto" value="Click aqui para registrar un producto de manera definitiva" />
        <br />
      </h:form>
    </p:dialog>
    <!-- TABLA CON LOS SUBPRODUCTOS -->
    <p:dialog widgetVar="dlgEditarSubproductosProducto" header="Modifique o agregue subproductos" modal="true" resizable="false" style="width: 600px">
      <h:form id="editarSubproductosForm">
        <p:contextMenu for="tablaEditarSubproductos" style="width:220px;">
          <p:menuitem value="Editar" icon="ui-icon-pencil" actionListener="#{institucionesBean.controlDialogosEditarSubproducto()}" update=":growl" />
        </p:contextMenu>
        <p:dataTable id="tablaEditarSubproductos" var="subproducto" value="#{institucionesBean.listaSubproductos}" rowKey="#{subproducto.idSubproducto}" selection="#{institucionesBean.subproductoSeleccionado}" selectionMode="multiple" paginator="true" rows="10" emptyMessage="No hay subproductos registrados." style="width: 600px;">
          <f:facet name="header">
            Lista de subproductos registrados del producto: <h:outputText value="#{institucionesBean.seleccionado.nombre}" />
          </f:facet>
          <p:column headerText="Nombre del subproducto" style="width: 150px;">
            <p:outputLabel value="#{subproducto.nombre}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
          </p:column>
          <p:column headerText="Descripcion" style="width: 400px;"> 
            <h:outputText value="#{subproducto.descripcion}" style="font-family: 'Open Sans',sans-serif; font-weight: 700;" />
          </p:column>
          <f:facet name="footer">
            <p:commandButton icon="ui-icon-plus" value="Agregar un subproducto" actionListener="#{institucionesBean.controlDialogosNuevoSubproducto()}" />
          </f:facet>
        </p:dataTable>
      </h:form>
    </p:dialog>
    <!-- EDICION DE SUBPRODUCTO -->
    <p:dialog widgetVar="dlgEditarSubproducto" header="Editar datos del subproducto" modal="true" resizable="false" style="width: 300px">
      <h:form id="editarSubproductoForm">
        <h:outputText value="Nombre:" />
        <br />
        <p:inputText value="#{institucionesBean.subSeleccionado.nombre}" size="50" required="true" requiredMessage="Debe ingresar un nombre" />
        <br />
        <h:outputText value="Descripcion:" />
        <br />
        <p:inputTextarea value="#{institucionesBean.subSeleccionado.descripcion}" cols="50" rows="3" required="true" requiredMessage="Debe ingresar una descripcion" />
        <br />
        <br />
        <p:commandButton value="Aceptar" actionListener="#{institucionesBean.editarSubproducto()}" update=":growl" />
        <br />
      </h:form>
    </p:dialog>
    <!-- NUEVO PRODUCTO -->
    <p:dialog widgetVar="dlgNuevoSubproducto" header="Agregar un subproducto" modal="true" resizable="false" style="width: 300px">
      <!-- FORMULARIO PARA REGISTRAR UN NUEVO PRODUCTO -->
      <h:form id="nuevoSubproductoForm">
        <h:outputText value="Nombre del subproducto:" />
        <br />
        <p:inputText id="nombreSubproducto" value="#{institucionesBean.nombreSubproducto}" size="50" required="true" requiredMessage="Debe ingresar un nombre" />
        <p:tooltip for="nombreSubproducto" value="Indique el nombre completo del producto" />
        <br />
        <h:outputText value="Descripcion:" />
        <br />
        <p:inputTextarea id="descripcionSubproducto" value="#{institucionesBean.descripcionSubproducto}" cols="50" rows="3" required="true" requiredMessage="Debe ingresar una descripcion" />
        <p:tooltip for="descripcionSubproducto" value="Indique una breve descripcion para el producto" />
        <br />
        <p:commandButton id="creacionSubproducto" value="Aceptar" actionListener="#{institucionesBean.crearSubproducto()}" update=":growl, editarProductosForm:tablaEditarProductos" />
        <p:tooltip for="creacionSubproducto" value="Click aqui para registrar un producto de manera definitiva" />
        <br />
      </h:form>
    </p:dialog>
  </h:body>
</html>