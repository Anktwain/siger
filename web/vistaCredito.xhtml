<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Detalle de credito</title>
  </h:head> 
  <h:body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <div class="padding-md">
      <div class="clearfix" style="width: 1200px;">
        <div class="clearfix">
          <div class="pull-left">
            <div class="pull-left m-left-sm">
              <h3 class="m-bottom-xs m-top-xs">
                <p:outputLabel value="#{vistaCreditoBean.nombreDeudor}" style="font-size: 28px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              </h3>
            </div>
          </div>
          <div class="pull-right">
            <h5>
              <strong>
                Numero de credito: <p:outputLabel value="#{vistaCreditoBean.numeroCredito}" style="font-size: 24px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              </strong>
            </h5>
          </div>
        </div>
        <br />
        <div class="clearfix">
          <div class="pull-left">
            <strong>
              Direccion:
            </strong>
            <br />
            <p:outputLabel value="#{vistaCreditoBean.calleNumero}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.coloniaMunicipio}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.estadoCP}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>
              Telefono asociado al credito:
            </strong>
            <br />
            <p:outputLabel value="#{vistaCreditoBean.telefono}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>
              Correo electronico:
            </strong>
            <br />
            <p:outputLabel value="#{vistaCreditoBean.correo}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <h:form id="barraDetalleCreditoForm">
              <p:button value="Editar datos del deudor" outcome="deudores" />
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:button value="Convenios de pago" outcome="vistaConvenio" rendered="#{!vistaCreditoBean.adminVisible}" />
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:button value="Impresion de visitas" outcome="vistaVisitas"  />
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:commandButton value="Devolucion" oncomplete="PF('dialogoDevolucionVistaCredito').show();" />
              &nbsp;&nbsp;&nbsp;&nbsp;
              <p:selectOneMenu id="listaGestoresVistaCredito" value="#{vistaCreditoBean.gestorSeleccionado.idGestor}" style="width:200px" rendered="#{vistaCreditoBean.adminVisible}">
                <f:selectItem itemValue="#{vistaCreditoBean.gestorActual.idGestor}" itemLabel="#{vistaCreditoBean.gestorActual.usuario.nombreLogin}" />
                <f:selectItems value="#{vistaCreditoBean.listaGestores}" var="g" itemLabel="#{g.usuario.nombreLogin}" itemValue="#{g.idGestor}" />
                <p:ajax listener="#{vistaCreditoBean.confirmar()}" />
              </p:selectOneMenu>
            </h:form>
          </div>
          <div class="pull-right text-right">
            <strong>Fecha de inicio:</strong>
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.fechaInicio}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>Fecha Ultimo Pago:</strong>
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.fup}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>Fecha Ultimo Vencimiento Pagado:</strong>
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.fvp}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>Fecha Fin del credito:</strong>
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.fechaFin}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>Mensualidad:</strong>
            &nbsp;
            <h:outputText value="#{vistaCreditoBean.mensualidad}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;">
              <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
            </h:outputText>
            <br />
            <strong>Meses vencidos:</strong>
            &nbsp;
            <p:outputLabel value="#{vistaCreditoBean.mesesVencidos}" style="font-size: 15px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            <br />
            <strong>Saldo vencido:</strong>
            &nbsp;
            <h:outputText value="#{vistaCreditoBean.saldoVencido}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;">
              <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
            </h:outputText>
          </div>
        </div>
        <hr />
        <ui:include src="listaMarcajesCredito.xhtml" />
        <hr />
        <div class="clearfix">
          <ui:include src="nuevaGestion.xhtml" />
          <hr />
          <h:form id="DetalleCredito">
            <p:accordionPanel multiple="true" activeIndex="-  1">
              <p:tab title="Gestiones anteriores">
                <p:dataTable id="tablaGestionesAnteriores" var="g" value="#{vistaCreditoBean.listaGestiones}" emptyMessage="No existen gestiones anteriores." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Fecha" style="width: 200px;">
                    <h:outputText value="#{g.fecha}"/>
                  </p:column>
                  <p:column headerText="Gestion">
                    <h:outputText value="#{obtenerOracionCompletaGestionBean.obtenerOracion(g)}"/>
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Datos de contacto">
                <p:accordionPanel multiple="true" activeIndex="-1">
                  <p:tab title="Direcciones">
                    <p:dataTable id="tablaDireccionesDetalleCredito" var="d" value="#{vistaCreditoBean.listaDirecciones}" emptyMessage="No existen direcciones asociadas a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Calle y numero" style="width:500px;" > 
                        <h:outputText value="#{d.calle}"/>
                      </p:column>
                      <p:column headerText="Colonia" style="width:250px;" > 
                        <h:outputText value="#{d.colonia.nombre}"/>
                      </p:column>
                      <p:column headerText="Municipio" style="width:200px;" > 
                        <h:outputText value="#{d.municipio.nombre}"/>
                      </p:column>
                      <p:column headerText="Estado"> 
                        <h:outputText value="#{d.estadoRepublica.nombre}"/>
                      </p:column>
                      <p:column headerText="Codigo postal" style="width:150px;" > 
                        <h:outputText value="#{d.colonia.codigoPostal}"/>
                      </p:column>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Telefonos">
                    <p:dataTable id="tablaTelefonosDetalleCredito" var="t" value="#{vistaCreditoBean.listaTelefonos}" emptyMessage="No existen numeros telefonicos asociados a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Telefono" > 
                        <h:outputText value="#{t.numero}" />
                      </p:column>
                      <p:column headerText="Clave LADA" > 
                        <h:outputText value="#{t.lada}" />
                      </p:column>
                      <p:column headerText="Tipo" > 
                        <h:outputText value="#{t.tipo}" />
                      </p:column>
                      <p:column headerText="Horario de atencion"> 
                        <h:outputText value="#{t.horario}" />
                      </p:column>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Correos">
                    <p:dataTable id="tablaCorreosDetalleCredito" var="co" value="#{vistaCreditoBean.listaCorreos}" emptyMessage="No existen correos electronicos asociados a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Direccion" > 
                        <h:outputText value="#{co.direccion}" />
                      </p:column>
                      <p:column headerText="Tipo" > 
                        <h:outputText value="#{co.tipo}" />
                      </p:column>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Contactos">
                    <p:dataTable id="tablaContactosDetalleCredito" var="con" value="#{vistaCreditoBean.listaContactos}" emptyMessage="No existen contactos de credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Nombre del contacto" > 
                        <h:outputText value="#{con.sujeto.nombreRazonSocial}" />
                      </p:column>
                      <p:column headerText="Descripcion" > 
                        <h:outputText value="#{con.observaciones}" />
                      </p:column>
                    </p:dataTable>
                  </p:tab>
                </p:accordionPanel>
              </p:tab>
              <p:tab title="Otros creditos con adeudos">
                <p:dataTable id="tablaCreditosRelacionados" var="cre" value="#{vistaCreditoBean.credsRelacionados}" emptyMessage="No existen creditos relacionados." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Credito" style="width:100px;" > 
                    <h:outputText value="#{cre.numeroCredito}"/>
                  </p:column>
                  <p:column headerText="Tipo de credito"> 
                    <h:outputText value="#{vistaCreditoBean.etiquetarTipoCredito(cre.tipoCredito)}"/>
                  </p:column>
                  <p:column headerText="Producto"> 
                    <h:outputText value="#{cre.producto.nombre}"/>
                  </p:column>
                  <p:column headerText="Saldo vencido" style="width:150px;" > 
                    <h:outputText value="#{cre.monto}"/>
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Actualizaciones de este adeudo">
                <!-- FAC POR, FAC MES, ETC... -->
              </p:tab>
              <p:tab title="Historial de este credito">
                <p:dataTable id="tablaHistorialCredito" var="h" value="#{vistaCreditoBean.historial}" emptyMessage="El credito no cuenta con historial." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Fecha" style="width:150px;" > 
                    <h:outputText value="#{h.fecha}"/>
                  </p:column>
                  <p:column headerText="Evento"> 
                    <h:outputText value="#{h.evento}"/>
                  </p:column>
                </p:dataTable>
              </p:tab>
            </p:accordionPanel>
          </h:form>
          <p:dialog id="dlgConfirmacion" widgetVar="confirmacionDialog2" modal="true" header="Confirme esta reasignacion">
            <h:form>
              <h:outputText value="Esta seguro de que desea reasignar este credito?" />
              <br />
              <br />
              <h:outputText value="Esta accion hara que se finalicen todos los convenios de pago en curso." />
              <br />
              <br />
              <p:commandButton value="Si" icon="ui-icon-check" actionListener="#{vistaCreditoBean.reasignarGestor()}" update="growl" />
              <p:commandButton value="No" icon="ui-icon-close" actionListener="#{vistaCreditoBean.cerrar()}" />
            </h:form>
          </p:dialog>
          <p:dialog id="dlgDevolucionVistaCredito" widgetVar="dialogoDevolucionVistaCredito" modal="true" resizable="false" header="Confirme la solicitud de devolucion">
            <h:form>
              Esta seguro de que desea devolver este credito?
              <br />
              <br />
              Esta accion hara que el credito ya no se pueda gestionar.
              <br />
              <br />
              Seleccione el concepto de devolucion:
              <br />
              <p:selectOneMenu id="conceptoVistaCredito" value="#{vistaCreditoBean.conceptoSeleccionado.idConceptoDevolucion}" style="width:200px">
                <f:selectItem itemLabel="" itemValue="0" />
                <f:selectItems value="#{vistaCreditoBean.listaConceptos}" var="c" itemLabel="#{c.concepto}" itemValue="#{c.idConceptoDevolucion}" />
                <p:ajax update="motivoVistaCredito" listener="#{vistaCreditoBean.preparaMotivos()}" />
              </p:selectOneMenu>
              <br />
              <br />
              Motivo devolucion:
              <br />
              <p:selectOneMenu id="motivoVistaCredito" value="#{vistaCreditoBean.motivoSeleccionado.idMotivoDevolucion}" style="width:200px">
                <f:selectItem itemLabel="" itemValue="0" />
                <f:selectItems value="#{vistaCreditoBean.listaMotivos}" var="m" itemLabel="#{m.motivo}" itemValue="#{m.idMotivoDevolucion}" />
              </p:selectOneMenu>
              <br />
              <br />
              Observaciones:
              <br />
              <p:inputText value="#{vistaCreditoBean.observaciones}" style="width:300px" />
              <br />
              <br />
              <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.devolverCredito()}" update=":growl" />
              <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoDevolucionVistaCredito').hide();" />
            </h:form>
          </p:dialog>
        </div>
      </div>
    </div>
  </h:body>
</html>