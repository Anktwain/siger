<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
  </h:head>
  <h:body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <div class="padding-md">
      <div class="clearfix" style="width: 1200px;">
        <div class="clearfix">
          <h:form id="datosCreditoForm">
            <h3 class="m-bottom-xs m-top-xs">
              <p:outputLabel value="#{vistaCreditoBean.creditoActual.deudor.sujeto.nombreRazonSocial}" style="font-size: 28px; color: #{vistaCreditoBean.color}; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            </h3>
            <div class="pull-left">
              <h4 class="m-bottom-xs m-top-xs">
                <strong>
                  R.F.C: <p:outputLabel value="#{vistaCreditoBean.creditoActual.deudor.sujeto.rfc}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                </strong>
              </h4>
              <h4 class="m-bottom-xs m-top-xs">
                <strong>
                  Subproducto: <p:outputLabel value="#{vistaCreditoBean.creditoActual.subproducto.nombre}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                </strong>
              </h4>
              <h5>
                <strong>
                  Direccion:
                </strong>
              </h5>
              <p:outputLabel value="#{vistaCreditoBean.calleNumero}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              &nbsp;
              <p:outputLabel value="#{vistaCreditoBean.coloniaMunicipio}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              <br />
              <p:outputLabel value="#{vistaCreditoBean.estadoCP}" style="font-size: 14px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              <br />
              <h5>
                <strong>
                  Telefono asociado al credito:
                </strong>
              </h5>
              <p:outputLabel value="#{vistaCreditoBean.telefono}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              <br />
              <h5>
                <strong>
                  Telefono principal:
                </strong>
              </h5>
              <p:outputLabel value="#{vistaCreditoBean.telefonoPrincipal}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              <br />
              <h5>
                <strong>
                  Correo electronico principal:
                </strong>
              </h5>
              <p:outputLabel value="#{vistaCreditoBean.correo}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
              <br />
              <h5>
                <strong>
                  Informacion ultima gestion:
                </strong>
              </h5>
              <p:outputLabel value="#{vistaCreditoBean.estatusUltimaGestion}" style="font-size: 16px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
            </div>
            <div class="pull-right text-right">
              <table border="1">
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Numero de credito:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.creditoActual.numeroCredito}" style="font-size: 24px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Numero de cuenta:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.numeroCuenta}" style="font-size: 24px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Fecha de inicio:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.fechaInicio}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Fecha Ultimo Pago:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.fup}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Fecha Ultimo Vencimiento Pagado:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.fvp}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Fecha Fin del credito:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.fechaFin}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Fecha Quebranto:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.fechaQuebranto}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Monto credito:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <h:outputText value="#{vistaCreditoBean.creditoActual.monto}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </td>
                </tr>  
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Mensualidad:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <h:outputText value="#{vistaCreditoBean.creditoActual.mensualidad}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Meses vencidos:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.mesesVencidos}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Saldo vencido:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <h:outputText value="#{vistaCreditoBean.saldoVencido}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </td>
                </tr>
                <tr>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <strong>
                      Creditos de este cliente:
                    </strong>
                  </td>
                  <td style="padding-left: 10px; padding-right: 10px;">
                    <p:outputLabel value="#{vistaCreditoBean.numeroCreditos}" style="font-size: 20px; color: #777; background: #f9f9f9; font-family: 'Open Sans',sans-serif;" />
                  </td>
                </tr>
              </table>
            </div>
          </h:form>
        </div>
        <hr />
        <h:form id="barraDetalleCreditoForm">
          <p:commandButton value="Ver gestiones anteriores" actionListener="#{sigerViejoBean.obtenerGestionesAnteriores(vistaCreditoBean.creditoActual.numeroCredito)}" oncomplete="PF('dialogoGestionesAnteriores').show();" update="gestionesAnterioresForm" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Ver direcciones anteriores" actionListener="#{sigerViejoBean.obtenerDireccionesAnteriores(vistaCreditoBean.creditoActual.numeroCredito)}" oncomplete="PF('dialogoDireccionesAnteriores').show();" update="direccionesAnterioresForm" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Ver datos de contacto anteriores" actionListener="#{sigerViejoBean.obtenerDatosContactoAnteriores(vistaCreditoBean.creditoActual.numeroCredito)}" oncomplete="PF('dialogoDatosContactoAnteriores').show();" update="datosContactoAnterioresForm" />
          <!-- <p:button value="Editar datos del deudor" outcome="deudores" disabled="true" /> -->
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:button value="Convenios de pago" outcome="vistaConvenio" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Devolucion" oncomplete="PF('dialogoDevolucionVistaCredito').show();" />
          &nbsp;&nbsp;&nbsp;&nbsp;
          <p:commandButton value="Marcar como urgente" actionListener="#{vistaCreditoBean.marcarUrgente()}" disabled="#{vistaCreditoBean.habilitaUrgente}" update=":growl, barraDetalleCreditoForm, formTablaMarcajes" rendered="#{indexBean.adminVisible}" />
        </h:form>
        <br />
        <br />
        <h:form id="reasignarGestorForm" rendered="#{indexBean.adminVisible}">
          <h5>
            <strong>
              Gestor actual:
            </strong>
          </h5>
          <p:selectOneMenu id="listaGestoresVistaCredito" value="#{vistaCreditoBean.gestorSeleccionado.idGestor}" style="width:200px">
            <f:selectItem itemValue="#{vistaCreditoBean.creditoActual.gestor.idGestor}" itemLabel="#{vistaCreditoBean.creditoActual.gestor.usuario.nombreLogin}" />
            <f:selectItems value="#{vistaCreditoBean.listaGestores}" var="ges" itemLabel="#{ges.usuario.nombreLogin}" itemValue="#{ges.idGestor}" />
            <p:ajax listener="#{vistaCreditoBean.confirmar()}" />
          </p:selectOneMenu>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <strong>
            Seleccione el combobox para reasignar la cuenta.
          </strong>
        </h:form>
        <hr />
        <ui:include src="listaMarcajesCredito.xhtml" />
        <hr />
        <div class="clearfix">
          <ui:include src="nuevaGestion.xhtml" />
          <hr />
          <h:form id="DetalleCredito">
            <p:accordionPanel multiple="true" activeIndex="0">
              <p:tab title="Gestiones anteriores">
                <p:dataTable id="tablaGestionesAnteriores" var="g" value="#{vistaCreditoBean.listaGestiones}" emptyMessage="No existen gestiones anteriores." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Fecha" style="width: 200px;">
                    <h:outputText value="#{g.fecha}"/>
                  </p:column>
                  <p:column headerText="Gestion">
                    <h:outputText value="#{obtenerOracionCompletaGestionBean.obtenerOracion(g)}"/>
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Datos de contacto">
                <p:accordionPanel multiple="true" activeIndex="-1">
                  <p:tab title="Direcciones">
                    <p:contextMenu for="tablaDireccionesDetalleCredito" style="width:200px;">
                      <p:menuitem value="Editar" icon="ui-icon-wrench" actionListener="#{vistaCreditoBean.prepararDireccion()}" oncomplete="PF('dialogoEditarDireccion').show();" update="editarDireccionForm" />
                      <p:menuitem value="Generar carta (visita)" icon="ui-icon-document" oncomplete="PF('dialogoImpresionVisitas').show();" />
                    </p:contextMenu>
                    <p:dataTable id="tablaDireccionesDetalleCredito" var="d" value="#{vistaCreditoBean.listaDirecciones}" selection="#{vistaCreditoBean.direccionSeleccionada}" selectionMode="single" rowKey="#{d.idDireccion}" emptyMessage="No existen direcciones asociadas a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Calle y numero" style="width:300px;" > 
                        <h:outputText value="#{d.calle} #{d.exterior} #{d.interior}"/>
                      </p:column>
                      <p:column headerText="Colonia" style="width:250px;" > 
                        <h:outputText value="#{d.colonia.nombre}"/>
                      </p:column>
                      <p:column headerText="Municipio" style="width:200px;" > 
                        <h:outputText value="#{d.municipio.nombre}"/>
                      </p:column>
                      <p:column headerText="Estado" style="width:150px;"> 
                        <h:outputText value="#{d.estadoRepublica.nombre}"/>
                      </p:column>
                      <p:column headerText="C.P." style="width:50px;" > 
                        <h:outputText value="#{d.colonia.codigoPostal}"/>
                      </p:column>
                      <f:facet name="footer">
                        <p:commandButton value="Agregar nueva direccion" icon="ui-icon-plus" oncomplete="PF('dialogoNuevaDireccion').show();" />
                      </f:facet>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Telefonos">
                    <p:contextMenu for="tablaTelefonosDetalleCredito" style="width:250px;">
                      <p:menuitem value="Establecer como principal" icon="ui-icon-star" actionListener="#{vistaCreditoBean.establecerTelefonoPrincipal(vistaCreditoBean.telefonoSeleccionado)}" update=":growl, datosCreditoForm" />
                    </p:contextMenu>
                    <p:dataTable id="tablaTelefonosDetalleCredito" var="t" value="#{vistaCreditoBean.listaTelefonos}" selection="#{vistaCreditoBean.telefonoSeleccionado}" selectionMode="single" rowKey="#{t.idTelefono}" emptyMessage="No existen numeros telefonicos asociados a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Telefono" > 
                        <h:outputText value="#{t.numero}" />
                      </p:column>
                      <p:column headerText="Clave LADA" > 
                        <h:outputText value="#{t.lada}" />
                      </p:column>
                      <p:column headerText="Tipo" > 
                        <h:outputText value="#{t.tipo}" />
                      </p:column>
                      <p:column headerText="Horario de atencion"> 
                        <h:outputText value="#{t.horario}" />
                      </p:column>
                      <f:facet name="footer">
                        <p:commandButton value="Agregar nuevo telefono" icon="ui-icon-plus" oncomplete="PF('dialogoNuevoTelefono').show();" />
                      </f:facet>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Correos">
                    <p:contextMenu for="tablaCorreosDetalleCredito" style="width:250px;">
                      <p:menuitem value="Establecer como principal" icon="ui-icon-star" actionListener="#{vistaCreditoBean.establecerCorreoPrincipal(vistaCreditoBean.correoSeleccionado)}" update=":growl, datosCreditoForm" />
                    </p:contextMenu>
                    <p:dataTable id="tablaCorreosDetalleCredito" var="co" value="#{vistaCreditoBean.listaCorreos}" selection="#{vistaCreditoBean.correoSeleccionado}" selectionMode="single" rowKey="#{co.idEmail}" emptyMessage="No existen correos electronicos asociados a este credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Direccion" > 
                        <h:outputText value="#{co.direccion}" />
                      </p:column>
                      <p:column headerText="Tipo" > 
                        <h:outputText value="#{co.tipo}" />
                      </p:column>
                      <f:facet name="footer">
                        <p:commandButton value="Agregar nuevo correo" icon="ui-icon-plus" oncomplete="PF('dialogoNuevoCorreo').show();" />
                      </f:facet>
                    </p:dataTable>
                  </p:tab>
                  <p:tab title="Contactos">
                    <p:dataTable id="tablaContactosDetalleCredito" var="con" value="#{vistaCreditoBean.listaContactos}" emptyMessage="No existen contactos de credito." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                      <p:column headerText="Nombre del contacto" > 
                        <h:outputText value="#{con.nombre}" />
                      </p:column>
                      <p:column headerText="Tipo de contacto" > 
                        <h:outputText value="#{con.tipo}" />
                      </p:column>
                      <p:column headerText="Observaciones" > 
                        <h:outputText value="#{con.observaciones}" />
                      </p:column>
                      <f:facet name="footer">
                        <p:commandButton value="Agregar nuevo contacto" icon="ui-icon-plus" oncomplete="PF('dialogoNuevoContacto').show();" />
                      </f:facet>
                    </p:dataTable>
                  </p:tab>
                </p:accordionPanel>
              </p:tab>
              <p:tab title="Otros creditos con adeudos" rendered="#{vistaCreditoBean.habilitaCredsRelacionados}">
                <p:contextMenu for="tablaCreditosRelacionados" style="width:200px;">
                  <p:menuitem value="Ver credito" icon="ui-icon-arrowreturnthick-1-n" actionListener="#{vistaCreditoBean.abrirCreditoRelacionado()}" />
                </p:contextMenu>
                <p:dataTable id="tablaCreditosRelacionados" var="cre" value="#{vistaCreditoBean.creditosRelacionados}" selection="#{vistaCreditoBean.creditoRelacionadoSeleccionado}" selectionMode="single" rowKey="#{cre.idCredito}" emptyMessage="No existen creditos relacionados." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Credito" style="width:100px;" > 
                    <h:outputText value="#{cre.numeroCredito}"/>
                  </p:column>
                  <p:column headerText="Institucion">
                    <h:outputText value="#{cre.producto.institucion.nombreCorto}"/>
                  </p:column>
                  <p:column headerText="Producto">
                    <h:outputText value="#{cre.producto.nombre}"/>
                  </p:column>
                  <p:column headerText="Subproducto">
                    <h:outputText value="#{cre.subproducto.nombre}"/>
                  </p:column>
                  <p:column headerText="Mensualidad">
                    <h:outputText value="#{cre.mensualidad}">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </p:column>
                  <p:column headerText="Saldo vencido" style="width:150px;" > 
                    <h:outputText value="#{vistaCreditoBean.obtenerSaldoVencido(cre.idCredito)}">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Respuesta de telmex" rendered="#{vistaCreditoBean.habilitaFacs}">
                <p:dataTable id="tablaActualizacionCredito" var="fac" value="#{vistaCreditoBean.actualizaciones}" emptyMessage="El credito no cuenta con actualizaciones." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom" style="width: 900px;" >
                  <p:column headerText="Mes" style="width:100px;"> 
                    <h:outputText value="#{vistaCreditoBean.etiquetarMes(fac.mes)}"/>
                  </p:column>
                  <p:column headerText="Año" style="width:50px;"> 
                    <h:outputText value="#{fac.anio}"/>
                  </p:column>
                  <p:column headerText="Monto" style="width:150px;">
                    <h:outputText value="#{fac.facPor}" style="float:right">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </p:column>
                  <p:column headerText="Respuesta" style="width:250px;"> 
                    <h:outputText value="#{fac.facMes}"/>
                  </p:column>
                  <p:column headerText="Meses vencidos" style="width:150px;"> 
                    <h:outputText value="#{fac.actualizacion.mesesVencidos}" style="float:right" />
                  </p:column>
                  <p:column headerText="Saldo vencido" style="width:150px;"> 
                    <h:outputText value="#{fac.actualizacion.saldoVencido}" style="float:right">
                      <f:convertNumber  maxFractionDigits="2" currencySymbol="$" minFractionDigits="2" type="currency" />
                    </h:outputText>
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Ajustes" rendered="#{vistaCreditoBean.habilitaAjustes}">
                <p:dataTable id="tablaAjustesCredito" var="aj" value="#{vistaCreditoBean.ajustes}" emptyMessage="El credito no cuenta con ajustes." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom" style="width: 600px;" >
                  <p:column headerText="Tipo de ajuste" style="width:150px;"> 
                    <h:outputText value="#{vistaCreditoBean.etiquetarAjuste(aj.tipo)}"/>
                  </p:column>
                  <p:column headerText="Ajuste" style="width:400px;"> 
                    <h:outputText value="#{aj.ajuste}" style="float:right" />
                  </p:column>
                </p:dataTable>
              </p:tab>
              <p:tab title="Historial de este credito" rendered="#{vistaCreditoBean.habilitaHistorial}">
                <p:dataTable id="tablaHistorialCredito" var="h" value="#{vistaCreditoBean.historial}" emptyMessage="El credito no cuenta con historial." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom">
                  <p:column headerText="Fecha" style="width:150px;" > 
                    <h:outputText value="#{h.fecha}"/>
                  </p:column>
                  <p:column headerText="Evento"> 
                    <h:outputText value="#{h.evento}"/>
                  </p:column>
                </p:dataTable>
              </p:tab>
            </p:accordionPanel>
          </h:form>
        </div>
      </div>
    </div>
  </h:body>
  <!-- DIALOGO CONFIRMAR REASIGNACION -->
  <p:dialog id="dlgConfirmacion" widgetVar="confirmacionDialog2" modal="true" header="Confirme esta reasignacion">
    <h:form>
      <h:outputText value="Esta seguro de que desea reasignar este credito?" />
      <br />
      <br />
      <p:commandButton value="Si" icon="ui-icon-check" actionListener="#{vistaCreditoBean.reasignarGestor()}" update="growl" />
      <p:commandButton value="No" icon="ui-icon-close" actionListener="#{vistaCreditoBean.cerrar()}" />
    </h:form>
  </p:dialog>
  <!-- DIALOGO DEVOLUCION CREDITO -->
  <p:dialog id="dlgDevolucionVistaCredito" widgetVar="dialogoDevolucionVistaCredito" modal="true" resizable="false" header="Confirme la solicitud de devolucion">
    <h:form>
      Esta seguro de que desea devolver este credito?
      <br />
      <br />
      Esta accion hara que el credito ya no se pueda gestionar.
      <br />
      <br />
      Seleccione el concepto de devolucion:
      <br />
      <p:selectOneMenu id="conceptoVistaCredito" value="#{vistaCreditoBean.conceptoSeleccionado.idConceptoDevolucion}" style="width:200px">
        <f:selectItem itemLabel="" itemValue="0" />
        <f:selectItems value="#{vistaCreditoBean.listaConceptos}" var="c" itemLabel="#{c.concepto}" itemValue="#{c.idConceptoDevolucion}" />
        <p:ajax update="motivoVistaCredito" listener="#{vistaCreditoBean.preparaMotivos()}" />
      </p:selectOneMenu>
      <br />
      <br />
      Seleccione el motivo de la devolucion:
      <br />
      <p:selectOneMenu id="motivoVistaCredito" value="#{vistaCreditoBean.motivoSeleccionado.idMotivoDevolucion}" style="width:200px">
        <f:selectItem itemLabel="" itemValue="0" />
        <f:selectItems value="#{vistaCreditoBean.listaMotivos}" var="m" itemLabel="#{m.motivo}" itemValue="#{m.idMotivoDevolucion}" />
      </p:selectOneMenu>
      <br />
      <br />
      Observaciones:
      <br />
      <p:inputText value="#{vistaCreditoBean.observaciones}" style="width:300px" />
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.devolverCredito()}" oncomplete="PF('dialogoDevolucionVistaCredito').hide();" update=":growl" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoDevolucionVistaCredito').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO DEVOLUCION CREDITO IMPRESION DE VISITAS -->
  <p:dialog id="dlgImpresionVisitas" widgetVar="dialogoImpresionVisitas" modal="true" resizable="false" header="Impresion de visitas">
    <h:form id="visitasForm">
      <!-- TO DO: -->
      <!-- CREAR UN COMBOBOX CON LAS DIRECCIONES PARA QUE SE ELIJA CON CUAL SE VA A IMPRIMIR LA VISITA -->
      <table>
        <tr>
          <td>
            <h:outputText value="Periodo de impresion de correo ordinario" style="color: #00CC00; font-size: 16px; font-family: 'Open Sans',sans-serif;" />
          </td>
          <td style="padding-left: 10px;">
            <p:commandButton value="Generar" icon="ui-icon-gear" actionListener="#{visitasBean.generarCorreo()}" rendered="#{!visitasBean.periodoSepomexActivo}" update=":growl, visitasForm" />
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 20px;">
          </td>
        </tr>
        <tr>
          <td>
            <h:outputText value="Periodo de impresion para visita domiciliaria" style="color: #00CC00; font-size: 16px; font-family: 'Open Sans',sans-serif;" />
          </td>
          <td style="padding-left: 10px;">
            <p:commandButton value="Generar" icon="ui-icon-gear" actionListener="#{visitasBean.generarVisita()}" rendered="#{visitasBean.periodoVisitasActivo}" update=":growl, visitasForm" />
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 20px;">
          </td>
        </tr>
        <tr>
          <td>
            <h:outputText value="Generar carta para correo electronico" style="font-size: 16px; font-family: 'Open Sans',sans-serif;" />
          </td>
          <td style="padding-left: 10px;">
            <p:commandButton value="Generar" icon="ui-icon-gear" actionListener="#{visitasBean.generarNormal()}" update=":growl, visitasForm" />
          </td>
        </tr>
      </table>
      <br />
      <div align="center">
        <p:button value="Descargar" icon="ui-icon-arrowthick-1-s" rendered="#{visitasBean.descargarPdf}" href="#{visitasBean.rutaPdf}" target="_blank" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA VER LAS GESTIONES ANTERIORES -->
  <p:dialog id="dlgGestionesAnteriores" widgetVar="dialogoGestionesAnteriores" modal="true" resizable="false" header="Gestiones del sistema anterior">
    <h:form id="gestionesAnterioresForm">
      <p:dataTable id="tablaGestionesViejas" var="g" value="#{sigerViejoBean.listaGestiones}" emptyMessage="No existen gestiones para este credito en el sistema anterior." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom" style="width: 600px;">
        <p:column headerText="Fecha" style="width:100px;" > 
          <h:outputText value="#{g.fechaGestion}"/>
        </p:column>
        <p:column headerText="Gestion" > 
          <h:outputText value="#{g.gestion}"/>
        </p:column>
      </p:dataTable>
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" oncomplete="PF('dialogoGestionesAnteriores').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA VER LAS DIRECCIONES ANTERIORES -->
  <p:dialog id="dlgDireccionesAnteriores" widgetVar="dialogoDireccionesAnteriores" modal="true" resizable="false" header="Direcciones del sistema anterior">
    <h:form id="direccionesAnterioresForm">
      <p:dataTable id="tablaDireccionesViejas" var="d" value="#{sigerViejoBean.listaDirecciones}" emptyMessage="No existen direcciones para este credito en el sistema anterior." paginator="true" paginatorAlwaysVisible="false" rows="15" paginatorPosition="bottom" style="width: 950px;">
        <p:column headerText="Calle y numero" style="width:250px;" > 
          <h:outputText value="#{d.calleNum}"/>
        </p:column>
        <p:column headerText="Colonia" style="width:200px;" > 
          <h:outputText value="#{d.colonia}"/>
        </p:column>
        <p:column headerText="Municipio" style="width:200px;" > 
          <h:outputText value="#{d.municipio}"/>
        </p:column>
        <p:column headerText="Estado" style="width:200px;" > 
          <h:outputText value="#{d.estado}"/>
        </p:column>
        <p:column headerText="C.P." style="width:80px;" > 
          <h:outputText value="#{d.cp}"/>
        </p:column>
      </p:dataTable>
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" oncomplete="PF('dialogoGestionesAnteriores').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA VER DATOS DE CONTACTO ANTERIORES -->
  <p:dialog id="dlgDatosContactoAnteriores" widgetVar="dialogoDatosContactoAnteriores" modal="true" resizable="false" header="Datos de contacto del sistema anterior">
    <h:form id="datosContactoAnterioresForm">
      <div align="center">
        <p:dataTable id="tablaTelefonosViejos" var="t" value="#{sigerViejoBean.listaTelefonos}" 
                     emptyMessage="No existen telefonos para este credito en el sistema anterior." 
                     paginator="true" paginatorAlwaysVisible="false" rows="5" paginatorPosition="bottom" 
                     style="width: 850px;">
          <f:facet name="header">
            Telefonos en el sistema anterior
          </f:facet>
          <p:column headerText="Telefono" style="width:150px;" > 
            <h:outputText value="#{t.numero}"/>
          </p:column>
          <p:column headerText="Extension" style="width:50px;" > 
            <h:outputText value="#{t.extension}"/>
          </p:column>
          <p:column headerText="Lada" style="width:50px;" > 
            <h:outputText value="#{t.lada}"/>
          </p:column>
          <p:column headerText="Tipo" style="width:150px;" > 
            <h:outputText value="#{t.tipo}"/>
          </p:column>
          <p:column headerText="Lugar" style="width:150px;" > 
            <h:outputText value="#{t.lugar}"/>
          </p:column>
          <p:column headerText="Horario" style="width:150px;" > 
            <h:outputText value="#{t.horario}"/>
          </p:column>
        </p:dataTable>
        <br />
        <br />
        <p:dataTable id="tablaContactosViejos" var="c" value="#{sigerViejoBean.listaContactos}" 
                     emptyMessage="No existen contactos para este credito en el sistema anterior." 
                     paginator="true" paginatorAlwaysVisible="false" rows="5" paginatorPosition="bottom" 
                     style="width: 800px;">
          <f:facet name="header">
            Contactos en el sistema anterior
          </f:facet>
          <p:column headerText="Nombre" style="width:300px;" > 
            <h:outputText value="#{c.nombre}"/>
          </p:column>
          <p:column headerText="Tipo" style="width:200px;" > 
            <h:outputText value="#{c.tipo}"/>
          </p:column>
          <p:column headerText="Observaciones" style="width:250px;" > 
            <h:outputText value="#{c.observaciones}"/>
          </p:column>
        </p:dataTable>
      </div>
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" oncomplete="PF('dialogoGestionesAnteriores').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA AGREGAR UN NUEVO TELEFONO -->
  <p:dialog id="dlgNuevoTelefono" widgetVar="dialogoNuevoTelefono" modal="true" resizable="false" header="Dar de alta un telefono">
    <h:form id="nuevoTelefonoForm">
      <br />
      <table align="center">
        <tr>
          <td>
            (
          </td>
          <td>
            <p:inputText value="#{vistaCreditoBean.ladaNuevoTelefono}" size="5" maxlength="3" />
          </td>
          <td>
            ) - &nbsp;
          </td>
          <td>
            <p:inputText value="#{vistaCreditoBean.nuevoTelefono}" size="15" maxlength="15" required="true" requiredMessage="Debe introducir un numero telefonico." />
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <td align="center">
            Clave lada
          </td>
          <td>
          </td>
          <td align="center">
            Numero
          </td>
        </tr>
      </table>
      <br />
      <br />
      Tipo de telefono:
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.tipoNuevoTelefono}" size="30" maxlength="50" required="true" requiredMessage="Indique de que tipo de telefono se trata." />
      <br />
      <br />
      Horario de atencion:
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.horarioNuevoTelefono}" size="26" maxlength="40" />
      <br />
      <br />
      Convertir en principal
      &nbsp;&nbsp;
      <p:selectBooleanCheckbox value="#{vistaCreditoBean.principalNuevoTelefono}" />
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.agregarTelefono()}" update=":growl, datosCreditoForm, nuevoTelefonoForm" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoNuevoTelefono').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA AGREGAR UN NUEVO CORREO ELECTRONICO -->
  <p:dialog id="dlgNuevoCorreo" widgetVar="dialogoNuevoCorreo" modal="true" resizable="false" header="Dar de alta un nuevo email">
    <h:form id="nuevoCorreoForm">
      <br />
      Direccion de correo electronico:
      <br />
      <br />
      <p:inputText value="#{vistaCreditoBean.nuevoCorreo}" size="30" maxlength="60" />
      <br />
      <br />
      Tipo de correo:
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.tipoNuevoCorreo}" size="20" maxlength="15" required="true" requiredMessage="Indique de que tipo de telefono se trata." />
      <br />
      <br />
      Convertir en principal
      &nbsp;&nbsp;
      <p:selectBooleanCheckbox value="#{vistaCreditoBean.principalNuevoCorreo}" />
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.agregarEmail()}" oncomplete="PF('dialogoNuevoCorreo').hide();" update=":growl, datosCreditoForm, nuevoCorreoForm" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoNuevoCorreo').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA AGREGAR UN NUEVO CORREO ELECTRONICO -->
  <p:dialog id="dlgNuevoContacto" widgetVar="dialogoNuevoContacto" modal="true" resizable="false" header="Dar de alta un contacto para este credito">
    <h:form id="nuevoContactoForm">
      <br />
      Nombre del contacto:
      <br />
      <br />
      <p:inputText value="#{vistaCreditoBean.nuevoContacto}" size="30" maxlength="60" />
      <br />
      <br />
      Tipo de contacto:
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:selectOneMenu value="#{vistaCreditoBean.tipoNuevoContacto}" style="width:200px">
        <f:selectItems value="#{vistaCreditoBean.listaSujetos}" var="s" itemLabel="#{s}" itemValue="#{s}" />
      </p:selectOneMenu>
      <br />
      <br />
      Observaciones:
      <br />
      <p:inputTextarea id="gestion" rows="2" cols="30" value="#{vistaCreditoBean.observacionesContacto}">
        <p:ajax event="keyup" />
      </p:inputTextarea>
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.agregarContacto()}" oncomplete="PF('dialogoNuevoContacto').hide();" update=":growl, :DetalleCredito, nuevoContactoForm" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoNuevoContacto').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA EDITAR UNA DIRECCION -->
  <p:dialog id="dlgEditarDireccion" widgetVar="dialogoEditarDireccion" modal="true" resizable="false" header="Editar direccion">
    <h:form id="editarDireccionForm">
      Estado:
      &nbsp;&nbsp;
      <p:selectOneMenu value="#{vistaCreditoBean.direccionSeleccionada.estadoRepublica.idEstado}" style="width: 200px;">
        <f:selectItems value="#{vistaCreditoBean.listaEstados}" var="e2" itemLabel="#{e2.nombre}" itemValue="#{e2.idEstado}" />
        <p:ajax listener="#{vistaCreditoBean.obtenerMunicipios(vistaCreditoBean.direccionSeleccionada.estadoRepublica)}" update="comboboxMunicipiosDireccionSeleccionada, comboboxColoniasDireccionSeleccionada" />
      </p:selectOneMenu>
      <br />
      <br />
      Municipio:
      &nbsp;&nbsp;
      <p:selectOneMenu id="comboboxMunicipiosDireccionSeleccionada" value="#{vistaCreditoBean.direccionSeleccionada.municipio.idMunicipio}" filter="true" filterMatchMode="contains" style="width: 200px;">
        <f:selectItems value="#{vistaCreditoBean.listaMunicipios}" var="m2" itemLabel="#{m2.nombre}" itemValue="#{m2.idMunicipio}"/>
        <p:ajax listener="#{vistaCreditoBean.obtenerColonias(vistaCreditoBean.direccionSeleccionada.municipio)}" update="comboboxColoniasDireccionSeleccionada" />
      </p:selectOneMenu>
      <br />
      <br />
      Colonia:
      &nbsp;&nbsp;
      <p:selectOneMenu id="comboboxColoniasDireccionSeleccionada" value="#{vistaCreditoBean.direccionSeleccionada.colonia.idColonia}" filter="true" filterMatchMode="contains" style="width: 300px;">
        <f:selectItems value="#{vistaCreditoBean.listaColonias}" var="col2" itemLabel="#{col2.tipo} #{col2.nombre}" itemValue="#{col2.idColonia}"/>
        <p:ajax listener="#{vistaCreditoBean.actualizarColonia()}" update="cpDireccionSeleccionada" />
      </p:selectOneMenu>
      &nbsp;&nbsp;&nbsp;&nbsp;
      C.P:
      &nbsp;&nbsp;
      <h:outputText id="cpDireccionSeleccionada" value="#{vistaCreditoBean.direccionSeleccionada.colonia.codigoPostal}" />
      <br />
      <br />
      Calle:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.direccionSeleccionada.calle}" size="40" maxlength="100" />
      <br />
      <br />
      Numero exterior:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.direccionSeleccionada.exterior}" size="10" maxlength="30" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      Numero interior:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.direccionSeleccionada.interior}" size="10" maxlength="30" />
      <hr />
      Coordenadas GPS
      <br />
      <br />
      Latitud:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.direccionSeleccionada.latitud}" size="15" maxlength="11" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      Longitud:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.direccionSeleccionada.longitud}" size="15" maxlength="11" />
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Editar direccion" icon="ui-icon-pencil" actionListener="#{vistaCreditoBean.editarDireccion()}" oncomplete="PF('dialogoEditarDireccion').hide();" update=":growl, DetalleCredito" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoEditarDireccion').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA AGREGAR UNA DIRECCION -->
  <p:dialog id="dlgNuevaDireccion" widgetVar="dialogoNuevaDireccion" modal="true" resizable="false" header="Dar de alta una direccion para este credito">
    <h:form id="nuevaDireccionForm">
      Codigo postal:
      &nbsp;&nbsp;
      <p:inputText id="cpNuevaDireccion" value="#{vistaCreditoBean.cpNuevaDireccion}" size="10" maxlength="5" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      <p:commandButton value="Detectar" icon="ui-icon-search" actionListener="#{vistaCreditoBean.detectarDireccionPorCP()}" update=":growl, nuevaDireccionForm" />
      <br />
      <br />
      Estado:
      &nbsp;&nbsp;
      <p:selectOneMenu value="#{vistaCreditoBean.estadoNuevaDireccion.idEstado}" style="width: 200px;">
        <f:selectItem itemLabel="" itemValue="0" />
        <f:selectItems value="#{vistaCreditoBean.listaEstados}" var="e" itemLabel="#{e.nombre}" itemValue="#{e.idEstado}" />
        <p:ajax listener="#{vistaCreditoBean.obtenerMunicipios(vistaCreditoBean.estadoNuevaDireccion)}" update="comboboxMunicipiosNuevaDireccion, comboboxColoniasNuevaDireccion" />
      </p:selectOneMenu>
      <br />
      <br />
      Municipio:
      &nbsp;&nbsp;
      <p:selectOneMenu id="comboboxMunicipiosNuevaDireccion" value="#{vistaCreditoBean.municipioNuevaDireccion.idMunicipio}" filter="true" filterMatchMode="contains" style="width: 200px;">
        <f:selectItem itemLabel="" itemValue="0" />
        <f:selectItems value="#{vistaCreditoBean.listaMunicipios}" var="m" itemLabel="#{m.nombre}" itemValue="#{m.idMunicipio}"/>
        <p:ajax listener="#{vistaCreditoBean.obtenerColonias(vistaCreditoBean.municipioNuevaDireccion)}" update="comboboxColoniasNuevaDireccion" />
      </p:selectOneMenu>
      <br />
      <br />
      Colonia:
      &nbsp;&nbsp;
      <p:selectOneMenu id="comboboxColoniasNuevaDireccion" value="#{vistaCreditoBean.coloniaNuevaDireccion.idColonia}" filter="true" filterMatchMode="contains" style="width: 300px;">
        <f:selectItem itemLabel="" itemValue="0" />
        <f:selectItems value="#{vistaCreditoBean.listaColonias}" var="col" itemLabel="#{col.tipo} #{col.nombre}" itemValue="#{col.idColonia}"/>
        <p:ajax listener="#{vistaCreditoBean.completarCp()}" update="nuevaDireccionForm:cpNuevaDireccion" />
      </p:selectOneMenu>
      <br />
      <br />
      Calle:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.calleNuevaDireccion}" size="40" maxlength="50" />
      <br />
      <br />
      Numero exterior:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.exteriorNuevaDireccion}" size="10" maxlength="15" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      Numero interior:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.interiorNuevaDireccion}" size="10" maxlength="15" />
      <hr />
      Coordenadas GPS
      <br />
      <br />
      Latitud:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.latitudNuevaDireccion}" size="15" maxlength="11" />
      &nbsp;&nbsp;&nbsp;&nbsp;
      Longitud:
      &nbsp;&nbsp;
      <p:inputText value="#{vistaCreditoBean.longitudNuevaDireccion}" size="15" maxlength="11" />
      <hr />
      <div align="center">
        <p:commandButton value="Agregar direccion" icon="ui-icon-plus" actionListener="#{vistaCreditoBean.agregarDireccion()}" oncomplete="PF('dialogoNuevaDireccion').hide();" update=":growl, nuevaDireccionForm, DetalleCredito" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoNuevaDireccion').hide();" />
      </div>
    </h:form>
  </p:dialog>
  <!-- DIALOGO PARA ELIMINAR UNA DIRECCION -->
  <p:dialog id="dlgEliminarDireccion" widgetVar="dialogoEliminarDireccion" modal="true" resizable="false" header="Eliminar direccion">
    <h:form id="eliminarDireccionForm">
      Esta seguro de eliminar esta direccion?
      <br />
      <br />
      <div align="center">
        <p:commandButton value="Aceptar" icon="ui-icon-check" actionListener="#{vistaCreditoBean.eliminarDireccion()}" oncomplete="PF('dialogoEliminarDireccion').hide();" update=":growl, DetalleCredito" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <p:commandButton value="Cancelar" icon="ui-icon-close" oncomplete="PF('dialogoEliminarDireccion').hide();" />
      </div>
    </h:form>
  </p:dialog>
</html>