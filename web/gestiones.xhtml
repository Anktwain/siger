<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns="http://www.w3.org/1999/xhtml">
  <h:head>
    <meta charset="utf-8"></meta>
    <title>SigerWeb - Gestiones</title>
    <h:outputScript library="js" name="locale_es.js" />
  </h:head>
  <f:metadata>
    <f:event listener="#{indexBean.verificarAcceso('gestiones')}" type="preRenderView" />
  </f:metadata>
  <body>
    <p:growl id="growl" showDetail="true" sticky="true" />
    <!-- Overlay Div -->
    <div id="overlay" class="transparent" style="display: none"></div>
    <ui:include src="barraSuperior.xhtml" />
    <ui:include src="barraLateral.xhtml" />
    <div id="main-container">
      <div id="breadcrumb">
        <ul class="breadcrumb">
          <li>
            <i class="fa fa-home">
            </i>
            <a href="#{indexBean.vista}">Inicio</a>
          </li>
          <li class="active">
            Gestiones
          </li>
        </ul>
      </div>
      <div class="main-header clearfix">
        <div class="page-title">
          <h3 class="no-margin">Gestiones</h3>
          <span>Visualice rapidamente las gestiones que se han realizado en el despacho, filtre utilizando los diversos parametros para obtener un conjunto especifico de gestiones.</span>
          <span>Obtenga reportes sobre las gestiones elaboradas.</span>
        </div>
      </div>
      <hr />
      <div class="clearfix padding-md">
        <h:form id="formGestionesAdmin">
          <table>
            <tr>
              <td>
                <h4 class="no-margin">Especificar gestor:</h4>
              </td>
              <td style="padding-left: 20px;">
                <p:inputSwitch value="#{gestionesBean.habilitaGestor}" offLabel="No" onLabel="Si">
                  <p:ajax listener="#{gestionesBean.habilitaGestores()}" update="seleccionarGestorGestionesCombobox" />
                </p:inputSwitch>
              </td>
              <td style="padding-left: 20px;">
                <p:selectOneMenu id="seleccionarGestorGestionesCombobox" value="#{gestionesBean.gestorSeleccionado.idGestor}" style="width:200px" disabled="#{!gestionesBean.habilitaGestor}">
                  <f:selectItems value="#{gestionesBean.listaGestores}" var="g" itemLabel="#{g.usuario.nombreLogin}" itemValue="#{g.idGestor}" />
                </p:selectOneMenu>
              </td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td>
                <h4 class="no-margin">Especificar tipo de gestion:</h4>
              </td>
              <td style="padding-left: 20px;">
                <p:inputSwitch value="#{gestionesBean.habilitaTipoGestion}" offLabel="No" onLabel="Si">
                  <p:ajax listener="#{gestionesBean.habilitaTipoGestion()}" update="seleccionarTipoGestionGestionesCombobox" />
                </p:inputSwitch>
              </td>
              <td style="padding-left: 20px;">
                <p:selectOneMenu id="seleccionarTipoGestionGestionesCombobox" value="#{gestionesBean.tipoSeleccionado.idTipoGestion}" style="width:200px" disabled="#{!gestionesBean.habilitaTipoGestion}">
                  <f:selectItems value="#{gestionesBean.listaTipos}" var="t" itemLabel="#{t.nombre}" itemValue="#{t.idTipoGestion}" />
                </p:selectOneMenu>
              </td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td>
                <h4 class="no-margin">Especificar Institucion:</h4>
              </td>
              <td style="padding-left: 20px;">
                <p:inputSwitch value="#{gestionesBean.habilitaInstitucion}" offLabel="No" onLabel="Si">
                  <p:ajax listener="#{gestionesBean.habilitaInstituciones()}" update="seleccionarInstitucionGestionesCombobox" />
                </p:inputSwitch>
              </td>
              <td style="padding-left: 20px;">
                <p:selectOneMenu id="seleccionarInstitucionGestionesCombobox" value="#{gestionesBean.institucionSeleccionada.idInstitucion}" style="width:200px" disabled="#{!gestionesBean.habilitaInstitucion}">
                  <f:selectItems value="#{gestionesBean.listaInstituciones}" var="i" itemLabel="#{i.nombreCorto}" itemValue="#{i.idInstitucion}" />
                  <p:ajax update="seleccionarProductosGestionesCombobox" />
                </p:selectOneMenu>
              </td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td>
                <h4 class="no-margin">Especificar Producto:</h4>
              </td>
              <td style="padding-left: 20px;">
                <p:inputSwitch value="#{gestionesBean.habilitaProducto}" offLabel="No" onLabel="Si" disabled="#{!gestionesBean.habilitaInstitucion}">
                  <p:ajax listener="#{gestionesBean.habilitaProductos()}" update="seleccionarProductosGestionesCombobox" />
                </p:inputSwitch>
              </td>
              <td style="padding-left: 20px;">
                <p:selectOneMenu id="seleccionarProductosGestionesCombobox" value="#{gestionesBean.productoSeleccionado.idProducto}" style="width:300px" disabled="#{gestionesBean.habilitaProducto}">
                  <f:selectItems value="#{gestionesBean.listaProductos}" var="p" itemLabel="#{p.nombre}" itemValue="#{p.idProducto}" />
                </p:selectOneMenu>
              </td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td>
                <h4 class="no-margin">Fecha inicio:</h4>
                <br />
                <p:calendar id="startDate" value="#{gestionesBean.fechaInicio}" showOn="button" required="true" requiredMessage="Debe indicar una fecha inicial." locale="es">
                  <p:ajax event="dateSelect" update="endDate" />
                </p:calendar>
              </td>
              <td style="padding-left: 20px;"></td>
              <td style="padding-left: 20px;">
                <h4 class="no-margin">Fecha fin:</h4>
                <br />
                <p:calendar id="endDate" value="#{gestionesBean.fechaFin}" showOn="button" required="true" requiredMessage="Debe indicar una fecha final." locale="es" />
              </td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td style="padding-top: 20px"></td>
            </tr>
            <tr>
              <td>
                <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{gestionesBean.buscar()}" update="growl, tablaGestiones" />
                &nbsp;&nbsp;&nbsp;&nbsp;
                <p:button value="Limpiar" icon="ui-icon-refresh" outcome="gestiones" />
              </td>
            </tr>
          </table>
          <hr />
          <p:dataTable id="tablaGestiones" var="g" value="#{gestionesBean.listaGestiones}" emptyMessage="No existen gestiones." paginator="true" rows="10" paginatorPosition="bottom" rendered="#{gestionesBean.habilitaTabla}">
            <p:column headerText="Credito" style="width: 100px;">
              <h:outputText value="#{g.credito.numeroCredito}" />
            </p:column>
            <p:column headerText="Deudor" style="width: 300px;">
              <h:outputText value="#{g.credito.deudor.sujeto.nombreRazonSocial}" />
            </p:column>
            <p:column headerText="Producto" style="width: 200px;">
              <h:outputText value="#{g.credito.subproducto.nombre}" />
            </p:column>
            <p:column headerText="Fecha" style="width: 100px;">
              <h:outputText value="#{g.fecha}">
                <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
              </h:outputText>
            </p:column>
            <p:column headerText="Gestion">
              <h:outputText value="#{obtenerOracionCompletaGestionBean.obtenerOracion(g)}" />
            </p:column>
            <p:column headerText="Estatus banco" style="width: 150px;">
              <h:outputText value="#{g.estatusInformativo.estatus}" />
            </p:column>
            <f:facet name="footer">
              <div align="right">
                  <h:commandLink actionListener="#{gestionesBean.reportarExportacion('xls')}">
                  <p:graphicImage name="/img/iconos/excel.png" width="40" rendered="#{gestionesBean.permitirExport}" />
                  <p:dataExporter type="xls" target="tablaGestiones" fileName="#{gestionesBean.nombreArchivo}" />
                </h:commandLink>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <h:commandLink  actionListener="#{gestionesBean.reportarExportacion('pdf')}">
                  <p:graphicImage name="/img/iconos/pdf.png" width="40" rendered="#{gestionesBean.permitirExport}" />
                  <p:dataExporter type="pdf" preProcessor="#{gestionesBean.preparaPdf}" target="tablaGestiones" fileName="#{gestionesBean.nombreArchivo}"/>
                </h:commandLink>
              </div>
            </f:facet>
          </p:dataTable>
        </h:form>
      </div>
    </div><!-- /main-container -->
    <!-- Footer ================================================== -->
    <ui:include src="barraInferior.xhtml" />
  </body>
  <!-- DIALOGO BARRA DE CARGA -->
  <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
  <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false" >
    <p:graphicImage library="img" name="loadingBarra.gif" />
  </p:dialog>
</html>